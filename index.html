<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ğŸ§¸ è§’è½é›œè²¨èˆ– POS æœ€çµ‚ç²¾ç¢ºç‰ˆ</title>
    <style>
        :root { --main-brown: #b0a496; --bg-cream: #fcf8f5; --accent-brown: #8c7b6c; --price-red: #d9534f; --profit-green: #6b8e23; }
        body { font-family: sans-serif; background: var(--bg-cream); margin: 0; display: flex; flex-direction: column; height: 100vh; color: #5d5246; overflow: hidden; }
        header { background: var(--main-brown); color: white; padding: 12px; text-align: center; font-size: 1.3em; font-weight: bold; flex-shrink: 0; }
        .nav-bar { background: #e8e0d9; padding: 10px; display: flex; gap: 10px; overflow-x: auto; border-bottom: 2px solid #d1c7bc; flex-shrink: 0; }
        .nav-btn { background: white; border: 1px solid #d1c7bc; padding: 6px 15px; border-radius: 20px; white-space: nowrap; cursor: pointer; font-size: 0.85em; }
        .main-content { display: flex; flex: 1; overflow: hidden; padding: 10px; gap: 10px; }
        .item-area { flex: 2; overflow-y: auto; background: white; border-radius: 15px; padding: 15px; border: 2px solid #e8e0d9; }
        .cat-title { background: #fdf5f0; padding: 6px 15px; border-radius: 20px; margin: 15px 0 8px; font-weight: bold; border-left: 6px solid var(--main-brown); font-size: 0.9em; }
        .product-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(110px, 1fr)); gap: 8px; }
        .p-btn { background: white; border: 1px solid #f0e6dd; border-radius: 12px; padding: 8px 5px; text-align: center; cursor: pointer; box-shadow: 2px 2px 0 #e8e0d9; min-height: 70px; display: flex; flex-direction: column; justify-content: center; position: relative; }
        .p-btn.sold-out { opacity: 0.4; background: #eee; cursor: not-allowed; }
        .p-btn.discontinued { background: #ffebeb; border: 1px dashed #d9534f; color: #999; cursor: not-allowed; }
        .p-name { font-size: 0.7em; font-weight: bold; margin-bottom: 3px; line-height: 1.2; height: 2.4em; overflow: hidden; }
        .p-price { color: #c2966d; font-size: 0.9em; font-weight: bold; }
        .p-stock { font-size: 0.65em; color: #999; }
        .checkout-area { flex: 1; display: flex; flex-direction: column; gap: 10px; min-width: 300px; }
        .card { background: white; border-radius: 15px; padding: 12px; border: 2px solid #e8e0d9; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        #cart-list { max-height: 250px; overflow-y: auto; border-bottom: 2px dashed #e8e0d9; }
        .cart-item { display: flex; justify-content: space-between; align-items: center; padding: 5px; font-size: 0.8em; border-bottom: 1px solid #eee; }
        .total-display { font-size: 2em; font-weight: bold; color: var(--price-red); text-align: right; }
        .pay-btn { flex: 1; padding: 8px; border-radius: 8px; border: 1px solid #ccc; background: white; cursor: pointer; }
        .pay-btn.active { background: var(--accent-brown); color: white; }
        #admin-panel { position: fixed; inset: 10px; background: white; z-index: 1000; border-radius: 20px; display: none; flex-direction: column; padding: 15px; border: 3px solid var(--main-brown); }
    </style>
</head>
<body>

<header>ğŸ§¸ è§’è½é›œè²¨èˆ– POS (ç²¾ç¢ºæ ¡å°ç‰ˆ)</header>
<div class="nav-bar" id="navbar"></div>

<div class="main-content">
    <div class="item-area" id="item-area"></div>
    <div class="checkout-area">
        <div class="card">
            <strong>ğŸ›’ è³¼ç‰©è»Š</strong>
            <div id="cart-list"></div>
            <div style="text-align:right; margin-top:10px;">
                <span style="font-size:0.8em;">æŠ˜æ‰£:</span> <input type="number" id="discount" style="width:50px;" oninput="calc()">
                <div class="total-display">$<span id="final-total">0</span></div>
            </div>
            <div style="display:flex; gap:5px; margin:10px 0;">
                <button class="pay-btn active" id="btn-cash" onclick="setPay('ç¾é‡‘')">ğŸ’µ ç¾é‡‘</button>
                <button class="pay-btn" id="btn-elec" onclick="setPay('é›»æ”¯')">ğŸ“± é›»æ”¯</button>
            </div>
            <div style="background:#fdfaf0; padding:8px; border-radius:8px; font-size:0.9em;">
                æ”¶: <input type="number" id="cash-in" style="width:70px;" oninput="calcChange()"> 
                æ‰¾: <span id="cash-change" style="font-weight:bold; color:red;">0</span>
            </div>
            <button onclick="submitOrder()" style="width:100%; padding:12px; margin-top:10px; background:var(--profit-green); color:white; border:none; border-radius:10px; font-weight:bold; font-size:1.1em;">çµå¸³å®Œæˆ</button>
        </div>
        <div class="card" style="flex:1; overflow-y:auto;" id="order-log"></div>
    </div>
</div>

<div style="padding:10px; text-align:center;"><button onclick="toggleAdmin()">ğŸ› ï¸ ç®¡ç†å¾Œå° (ç‡Ÿæ”¶/åº«å­˜)</button></div>

<div id="admin-panel">
    <div style="display:flex; justify-content:space-between;"><h3>ç®¡ç†å¾Œå°</h3><button onclick="toggleAdmin()">âœ•</button></div>
    <div style="display:flex; gap:20px; margin-bottom:10px;">
        <div style="color:red;">ä»Šæ—¥ç‡Ÿæ”¶: $<span id="stat-revenue">0</span></div>
        <div style="color:green;">ä»Šæ—¥åˆ©æ½¤: $<span id="stat-profit">0</span></div>
    </div>
    <div style="flex:1; overflow:auto;"><table id="admin-table" style="width:100%; font-size:0.8em;"><thead><tr><th>ç·¨è™Ÿ</th><th>å“å</th><th>æˆæœ¬</th><th>å”®åƒ¹</th><th>åº«å­˜</th></tr></thead><tbody id="admin-tbody"></tbody></table></div>
</div>

<script>
    const fullInventory = [
        { cat: "A åŒ…åŒ…å€", items: [
            {id:"A01", n:"é‡ç¹”æ‰˜ç‰¹åŒ…(é»ƒé¬±é‡‘é¦™)", c:15, p:79, s:2}, {id:"A02", n:"é‡ç¹”æ‰˜ç‰¹åŒ…(ç±³è‰²å°ç™½ç‹—)", c:15, p:79, s:1}, {id:"A03", n:"æ³¢é»å°ç‹—åŒ–å¦åŒ…", c:30, p:99, s:2}, {id:"A04", n:"insè´è¶çµçšºè‚©åŒ…(éŠ€)", c:85, p:199, s:0, dis:true}, {id:"A05", n:"insè´è¶çµçšºè‚©åŒ…(è—)", c:85, p:199, s:1}, {id:"A06", n:"å¾©å¤æ‰‹æä¿é½¡çƒåŒ…(å’–)", c:100, p:249, s:1}, {id:"A07", n:"è±¹ç´‹æ‰‹æå°å»¢åŒ…(å’–)", c:80, p:149, s:1}, {id:"A08", n:"ç´ é¢æ–œèƒ¯çšºè‚©åŒ…(éŠ€)", c:90, p:199, s:1}, {id:"A09", n:"ç´ é¢æ–œèƒ¯çšºè‚©åŒ…(ç™½)", c:90, p:199, s:1}, {id:"A10", n:"æ³•å¼æœˆç‰™è…‹ä¸‹åŒ…(é»‘)", c:85, p:199, s:1}, {id:"A11", n:"æ³•å¼æœˆç‰™è…‹ä¸‹åŒ…(ç™½)", c:85, p:199, s:2}, {id:"A12", n:"é›²æœµè¿·ä½ æ‰‹æåŒ…(ç™½)", c:70, p:139, s:2}, {id:"A13", n:"é›²æœµè¿·ä½ æ‰‹æåŒ…(é»‘)", c:70, p:139, s:2}, {id:"A14", n:"å¾©å¤äº®çš®æ‰‹ææ–œèƒ¯åŒ…(é»‘)", c:140, p:249, s:0}, {id:"A15", n:"å°ç‹—æŠ˜ç–ŠåŒ–å¦åŒ…", c:55, p:99, s:1}, {id:"A16", n:"å¡å…¶è±¹ç´‹å°æ–¹åŒ…", c:55, p:139, s:1}, {id:"A17", n:"ç·¨ç¹”æœˆç‰™è…‹ä¸‹åŒ…(ç²‰ç´…)", c:95, p:199, s:1}, {id:"A18", n:"æ³•å¼è·³è‰²æœˆç‰™è…‹ä¸‹åŒ…(ç±³ç™½)", c:70, p:199, s:2}, {id:"A19", n:"Y2KéŠæ¢é›™è‚©åŒ…", c:90, p:199, s:1}, {id:"A20", n:"JKé¢¨æ—¥ç³»éƒµå·®åŒ…(å’–)", c:120, p:289, s:1}, {id:"A21", n:"æ¼†çš®æ³•æ£è…‹ä¸‹åŒ…(é»‘)", c:90, p:199, s:2}, {id:"A22", n:"çç é›™éŠæ¢è…‹ä¸‹åŒ…(ç²‰)", c:65, p:249, s:1}, {id:"A23", n:"çç é›™éŠæ¢è…‹ä¸‹åŒ…(ç™½)", c:65, p:249, s:1}, {id:"A24", n:"æ³•åœ‹å°çœ¾æ–¹å½¢è…‹ä¸‹åŒ…(é»‘)", c:60, p:199, s:2}, {id:"A25", n:"æ³•åœ‹å°çœ¾æ–¹å½¢è…‹ä¸‹åŒ…(ç´…æ£•)", c:60, p:199, s:2}, {id:"A26", n:"å¤§å®¹é‡ä¿é½¡çƒåŒ…(å’–)", c:80, p:289, s:1}, {id:"A27", n:"è•¾çµ²èŠ±é‚Šå¾ŒèƒŒåŒ…(é»‘)", c:70, p:199, s:1}, {id:"A28", n:"è•¾çµ²èŠ±é‚Šå¾ŒèƒŒåŒ…(ç²‰)", c:70, p:199, s:1}, {id:"A29", n:"éŸ“ç³»è¤¶çšºé›²æœµåŒ…", c:65, p:199, s:0}, {id:"A30", n:"é‡ç¹”ææ‰‹åŒ…(çœ¼é¡ç‹—)", c:65, p:139, s:2}, {id:"A31", n:"é‡ç¹”ææ‰‹åŒ…(ç´…æ ¼ç‹—)", c:65, p:139, s:2}
        ]},
        { cat: "B ç”Ÿæ´»å°ç‰©", items: [
            {id:"B01", n:"è¿·ä½ ç£å¸å°æª¯ç‡ˆ(è—)", c:30, p:79, s:3}, {id:"B02", n:"è¿·ä½ ç£å¸å°æª¯ç‡ˆ(ç¶ )", c:30, p:79, s:3}, {id:"B03", n:"ç« é­šæš–å…‰ç‡ˆ(è—)", c:40, p:89, s:2}, {id:"B04", n:"ç« é­šæš–å…‰ç‡ˆ(é»ƒ)", c:40, p:89, s:2}, {id:"B05", n:"é¬±é‡‘é¦™å°å£å¤¾(é»ƒ)", c:15, p:69, s:2}, {id:"B06", n:"é¬±é‡‘é¦™å°å£å¤¾(ç²‰)", c:15, p:69, s:2}, {id:"B07", n:"ä¸ƒå±¤æ¼¢å ¡å¡‘è† ç›¤", c:35, p:129, s:2}, {id:"B08", n:"é»ƒè‰²çœ¼ç›åŒ–å¦é¡", c:25, p:99, s:2}, {id:"B09", n:"ç²‰è‰²çœ¼ç›åŒ–å¦é¡", c:25, p:99, s:2}, {id:"B10", n:"ä¸™çƒ¯é¦¬å…‹ç­†(12è‰²)", c:40, p:99, s:2}, {id:"B11", n:"ä¸™çƒ¯é¦¬å…‹ç­†(48è‰²)", c:150, p:259, s:1}, {id:"B12", n:"ä¾¿åˆ©åº—å­˜éŒ¢ç½", c:85, p:159, s:1}, {id:"B13", n:"å»£è§’é¡æ‰‹æ©Ÿæ”¯æ¶", c:40, p:99, s:6}, {id:"B14", n:"å°éº¥éº¥è€³æ©Ÿå¸½", c:30, p:89, s:1}, {id:"B15", n:"å¤šå·´èƒºè¨ˆç®—æ©Ÿ(é»ƒ)", c:45, p:99, s:1}, {id:"B16", n:"å¤šå·´èƒºè¨ˆç®—æ©Ÿ(ç´«)", c:45, p:99, s:1}, {id:"B17", n:"å¤šå·´èƒºè¨ˆç®—æ©Ÿ(ç™½)", c:45, p:99, s:1}, {id:"B18", n:"é›²æœµé¡", c:15, p:49, s:1}, {id:"B19", n:"é…ªæ¢¨é¦™æ°›è Ÿç‡­", c:20, p:99, s:4}, {id:"B20", n:"æ©˜å­é¦™æ°›è Ÿç‡­", c:30, p:99, s:2}, {id:"B21", n:"è–èª•æ¨¹è Ÿç‡­(ç™½)", c:35, p:99, s:2}, {id:"B22", n:"è–èª•æ¨¹è Ÿç‡­(ç¶ )", c:35, p:99, s:2}, {id:"B23", n:"æŸ¿å­é¦™æ°›è Ÿç‡­", c:45, p:99, s:4}, {id:"B24", n:"å±±ç«¹é¦™æ°›è Ÿç‡­", c:45, p:99, s:4}, {id:"B25", n:"æ§æ˜Ÿäººæ‰‹æ©Ÿæ°£å›Š", c:10, p:59, s:2}, {id:"B26", n:"çœ‹æ˜Ÿäººæ‰‹æ©Ÿæ°£å›Š", c:10, p:59, s:2}, {id:"B27", n:"ç„¡å°¾ç†Šç£å¸æ°£å›Š", c:28, p:79, s:2}, {id:"B28", n:"æ‰‹ææŠ±æ•æ¯¯(é¤…ä¹¾)", c:135, p:249, s:1}, {id:"B29", n:"æ‰‹ææŠ±æ•æ¯¯(å·§å…‹åŠ›)", c:135, p:249, s:1}, {id:"B30", n:"èƒ¡è˜¿è””éŒ„éŸ³ç­†", c:30, p:69, s:4}, {id:"B31", n:"å¯é Œæ›å‹¾", c:65, p:99, s:8}
        ]},
        { cat: "C æ“¦æ‰‹å·¾", items: [
            {id:"C01", n:"é›¨å‚˜æ“¦æ‰‹å·¾", c:20, p:79, s:1}, {id:"C02", n:"ç´…è‰²è˜‘è‡æ‰‹å·¾", c:21, p:79, s:2}, {id:"C03", n:"è—å¸½å­å°ç‹—æ‰‹å·¾", c:33, p:99, s:2}, {id:"C04", n:"éº¥ç•¶è²“æ“¦æ‰‹å·¾", c:38, p:99, s:1}, {id:"C05", n:"æµ·æ˜Ÿæ“¦æ‰‹å·¾", c:33, p:99, s:2}, {id:"C06", n:"æ°´æ¯æ“¦æ‰‹å·¾", c:33, p:99, s:2}, {id:"C07", n:"åŠ å¤§å¯æ„›ç‹—æ‰‹å·¾", c:33, p:129, s:2}, {id:"C08", n:"åŠ å¤§å¯æ„›ç†Šæ‰‹å·¾", c:33, p:129, s:1}, {id:"C09", n:"åŠ å¤§å¯æ„›è±¬æ‰‹å·¾", c:33, p:129, s:1}, {id:"C10", n:"å’–å•¡å°ç‹—æ“¦æ‰‹å·¾", c:15, p:99, s:2}, {id:"C11", n:"éºµåŒ…ç‹—æ“¦æ‰‹å·¾", c:18, p:99, s:1}, {id:"C12", n:"è¢‹å­ç‹—æ“¦æ‰‹å·¾", c:18, p:99, s:2}, {id:"C13", n:"èƒŒåŒ…ç‹—æ“¦æ‰‹å·¾", c:18, p:99, s:2}, {id:"C14", n:"ç·šæ¢ç‹—æ“¦æ‰‹å·¾", c:30, p:99, s:1}, {id:"C15", n:"æ˜Ÿæ˜Ÿäººæ“¦æ‰‹å·¾", c:20, p:99, s:0, dis:true}, {id:"C16", n:"æ´‹è”¥å°ç‹—æ“¦æ‰‹å·¾", c:20, p:99, s:1}, {id:"C17", n:"æ©˜å­å°ç‹—æ“¦æ‰‹å·¾", c:20, p:99, s:2}, {id:"C18", n:"åèˆŒé ­ç²‰ç´…ç‹—", c:22, p:99, s:2}, {id:"C19", n:"å¸½å­é•·è€³ç‹—", c:22, p:99, s:2}
        ]},
        { cat: "D é«®é£¾é¤¨", items: [
            {id:"D01", n:"ç£¨ç ‚ç„¡ç—•å¤¾(é»‘)", c:20, p:49, s:2}, {id:"D02", n:"ç£¨ç ‚ç„¡ç—•å¤¾(ç™½)", c:20, p:49, s:2}, {id:"D03", n:"æ³¢ç´‹å¥¶ç³–é¯Šé­šå¤¾", c:30, p:69, s:1}, {id:"D04", n:"èŠ±é‚Šå°é«®åœˆ", c:10, p:29, s:3}, {id:"D05", n:"å¸ƒé¢è±¹ç´‹ç„¡ç—•å¤¾", c:30, p:69, s:0, dis:true}, {id:"D06", n:"è—è‰²æ ¼å­æ«»èŠ±åœˆ", c:35, p:79, s:1}, {id:"D07", n:"è—è‰²æ«»èŠ±å¤§è…¸åœˆ", c:30, p:79, s:1}, {id:"D08", n:"æ¯›æ¯›é¯Šé­šå¤¾(æ·º)", c:25, p:69, s:1}, {id:"D09", n:"æ¯›æ¯›é¯Šé­šå¤¾(æ·±)", c:25, p:69, s:1}, {id:"D10", n:"æ„›å¿ƒé‘½ç„¡ç—•å¤¾", c:45, p:69, s:1}, {id:"D11", n:"çµ¨é¢æ„›å¿ƒæ°´æ»´(ç™½)", c:33, p:69, s:1}, {id:"D12", n:"çµ¨é¢æ„›å¿ƒæ°´æ»´(è±¹)", c:33, p:69, s:0, dis:true}, {id:"D13", n:"è´è¶çµæ ¼å­å°å¤¾", c:22, p:69, s:3}, {id:"D14", n:"å¸ƒé¢è±¹ç´‹èŠ±è‹åœˆ", c:36, p:79, s:0, dis:true}, {id:"D15", n:"ç´…é‚Šç°é«®åœˆ", c:35, p:79, s:1}, {id:"D16", n:"è—æ¢ç´‹å¥¶æ²¹åœˆ", c:30, p:79, s:1}, {id:"D18", n:"ç™½è‰²æ°´æ³¢ç´‹ç„¡ç—•å¤¾", c:18, p:49, s:0}, {id:"D20", n:"æ©¢åœ“è´è¶çµ(ç™½)", c:28, p:69, s:0, dis:true}, {id:"D21", n:"å¤§è™Ÿè±¹ç´‹å¤¾(å’–)", c:25, p:69, s:2}, {id:"D24", n:"çç è´è¶çµ(éŠ€)", c:30, p:79, s:2}, {id:"D26", n:"æ ¼ç´‹æ‰‡å½¢é¯Šé­šå¤¾", c:35, p:79, s:2}, {id:"D29", n:"è´è¶çµå¤§è…¸åœˆ(ç¶ )", c:25, p:79, s:0, dis:true}, {id:"D30", n:"è´è¶çµBBå¤¾(æ˜¥å¤©)", c:28, p:69, s:0, dis:true}, {id:"D33", n:"æ°´æ»´BBå¤¾(10å…¥)", c:5, p:29, s:8}, {id:"D35", n:"çç æ«»æ¡ƒç„¡ç—•å¤¾", c:30, p:79, s:3}, {id:"D37", n:"ç´ å’–+è±¹ç´‹æ©¢åœ“å¤¾", c:25, p:59, s:0}
        ]},
        { cat: "E å¨ƒå¨ƒ/æ›ä»¶", items: [
            {id:"E01", n:"ç•«å®¶è¥¿é«˜åœ°(å’–)", c:60, p:99, s:1}, {id:"E02", n:"ç•«å®¶è¥¿é«˜åœ°(è—)", c:60, p:99, s:0}, {id:"E05", n:"ç™½é›ªå…¬ä¸»è£è¥¿é«˜åœ°", c:75, p:129, s:0}, {id:"E08", n:"é•·æ¯›å°æ€ªç¸(ç²‰)", c:90, p:199, s:1}, {id:"E10", n:"éº¥ç•¶è²“å”å”æ›ä»¶", c:12, p:39, s:3}, {id:"E12", n:"åœ“é»å°ç‹—æ›ä»¶", c:15, p:49, s:3}, {id:"E13", n:"é¬±é‡‘é¦™æ›ä»¶(é»ƒ)", c:12, p:39, s:3}, {id:"E16", n:"ææ€ªé†œèŒèŠ±æœµ", c:13, p:49, s:5}, {id:"E17", n:"è£æ‰®æ€•æ´½ç‹—", c:38, p:79, s:1}, {id:"E18", n:"è–‘é¤…äºº", c:15, p:39, s:0, dis:true}, {id:"E22", n:"æŠ½æ‹‰å…”å­(ç´«)", c:60, p:129, s:1}, {id:"E24", n:"ä¸€æ¢ç‹—", c:42, p:99, s:5}
        ]},
        { cat: "F/G/H å€", items: [
            {id:"F01", n:"æ„›å¿ƒå…”å­ä¸­ç­’è¥ª", c:20, p:59, s:2}, {id:"F13", n:"ç¾Šæ¯›å †å †è¥ª(ç‹—)", c:25, p:69, s:4}, {id:"F19", o:"è™æ›¸æ¬£é»‘ç±³åœå·¾", c:70, p:199, s:2}, {id:"G01", n:"316å¸ç®¡æ¯600ml", c:130, p:239, s:3}, {id:"G04", n:"çç æ¹¯åŒ™å‰å­", c:55, p:99, s:5}, {id:"G06", n:"å¡çš®å·´æ‹‰ç­·(å¤ªé™½)", c:25, p:59, s:5}, {id:"G11", n:"5.5å‹æ¨¹å±‹ç¢—", c:85, p:189, s:0, dis:true}, {id:"G12", n:"8å‹è–¯æ¢ç›¤", c:40, p:99, s:2}, {id:"H01", n:"é¦¬å¹´å¤§å‰ç´…åŒ…5å…¥", c:6, p:39, s:5}, {id:"H13", n:"å¤šå·´èƒºæ°´æœ6å…¥", c:8, p:49, s:3}, {id:"H19", n:"è Ÿç­†å°æ–°6å…¥", c:22, p:59, s:2}
        ]}
    ];

    let inv = JSON.parse(localStorage.getItem('pos_inv_v3')) || fullInventory;
    let orders = JSON.parse(localStorage.getItem('pos_orders_v3')) || [];
    let cart = [];
    let currentPay = 'ç¾é‡‘';

    function init() {
        const area = document.getElementById('item-area'), nav = document.getElementById('navbar');
        area.innerHTML = ''; nav.innerHTML = '';
        inv.forEach((cat, idx) => {
            const cid = 'c'+idx;
            nav.innerHTML += `<div class="nav-btn" onclick="document.getElementById('${cid}').scrollIntoView()">${cat.cat}</div>`;
            let grid = `<div class="cat-title" id="${cid}">${cat.cat}</div><div class="product-grid">`;
            cat.items.forEach(it => {
                const state = it.dis ? 'discontinued' : (it.s <= 0 ? 'sold-out' : '');
                grid += `<div class="p-btn ${state}" onclick="addCart('${it.id}','${it.n}',${it.p},${it.c},${it.s},${it.dis})">
                    <div class="p-name">${it.id} ${it.n}</div>
                    <div class="p-price">$${it.p}</div>
                    <div class="p-stock">${it.dis?'åœå”®':(it.s<=0?'å®Œå”®':'å­˜:'+it.s)}</div>
                </div>`;
            });
            area.innerHTML += grid + '</div>';
        });
        updateLog();
    }

    function addCart(id, n, p, c, s, dis) {
        if(dis === 'true' || dis === true) return alert("åœå”®å“");
        if(s <= 0) return alert("ç„¡åº«å­˜");
        cart.push({id, n, p, c});
        renderCart();
    }

    function renderCart() {
        document.getElementById('cart-list').innerHTML = cart.map((it, i) => `
            <div class="cart-item"><span>${it.id} ${it.n}</span><b>$${it.p}</b><span onclick="cart.splice(${i},1);renderCart()">âœ•</span></div>
        `).join('');
        calc();
    }

    function setPay(m) {
        currentPay = m;
        document.getElementById('btn-cash').className = m==='ç¾é‡‘'?'pay-btn active':'pay-btn';
        document.getElementById('btn-elec').className = m==='é›»æ”¯'?'pay-btn active':'pay-btn';
    }

    function calc() {
        const total = cart.reduce((a,b)=>a+b.p, 0) - Number(document.getElementById('discount').value || 0);
        document.getElementById('final-total').innerText = Math.max(0, total);
        calcChange();
    }

    function calcChange() {
        const change = Number(document.getElementById('cash-in').value || 0) - Number(document.getElementById('final-total').innerText);
        document.getElementById('cash-change').innerText = change > 0 ? change : 0;
    }

    function submitOrder() {
        if(!cart.length) return;
        const total = Number(document.getElementById('final-total').innerText);
        const profit = total - cart.reduce((a,b)=>a+b.c, 0);
        
        cart.forEach(item => {
            inv.forEach(cat => cat.items.forEach(it => { if(it.id === item.id) it.s--; }));
        });

        orders.unshift({ t: new Date().toLocaleTimeString(), d: new Date().toLocaleDateString(), total, profit, detail: `[${currentPay}] `+cart.map(i=>i.id).join(',') });
        cart = []; document.getElementById('cash-in').value = '';
        localStorage.setItem('pos_inv_v3', JSON.stringify(inv));
        localStorage.setItem('pos_orders_v3', JSON.stringify(orders));
        init(); renderCart();
    }

    function updateLog() {
        const today = new Date().toLocaleDateString();
        const tOrders = orders.filter(o => o.d === today);
        document.getElementById('stat-revenue').innerText = tOrders.reduce((a,b)=>a+b.total, 0);
        document.getElementById('stat-profit').innerText = tOrders.reduce((a,b)=>a+b.profit, 0);
        document.getElementById('order-log').innerHTML = orders.slice(0,10).map(o => `<div style="font-size:0.7em; border-bottom:1px solid #eee; padding:3px;"><b>$${o.total}</b> ${o.t}<br>${o.detail}</div>`).join('');
    }

    function toggleAdmin() {
        const p = document.getElementById('admin-panel');
        p.style.display = p.style.display === 'flex' ? 'none' : 'flex';
        if(p.style.display === 'flex') {
            document.getElementById('admin-tbody').innerHTML = inv.flatMap(c => c.items).map(it => `
                <tr><td>${it.id}</td><td>${it.n}</td><td>${it.c}</td><td>${it.p}</td><td><input type="number" value="${it.s}" onchange="updateStock('${it.id}', this.value)"></td></tr>
            `).join('');
            updateLog();
        }
    }

    function updateStock(id, val) {
        inv.forEach(cat => cat.items.forEach(it => { if(it.id === id) it.s = Number(val); }));
        localStorage.setItem('pos_inv_v3', JSON.stringify(inv));
    }

    init();
</script>
</body>
</html>
