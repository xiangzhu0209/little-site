<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ğŸ§¸ LITTLE NOOK POS</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <style>
        :root { --main-brown: #b0a496; --bg-cream: #fcf8f5; --accent-brown: #8c7b6c; --price-red: #d9534f; --profit-green: #6b8e23; }
        
        /* ä¿®æ­£ï¼šé è¨­è®“ body é¡¯ç¤ºï¼Œæ”¹ç”¨å›ºå®šå±¤é–å± */
        body { font-family: sans-serif; background: var(--bg-cream); margin: 0; display: flex; flex-direction: column; height: 100vh; color: #5d5246; overflow: hidden; }

        /* é–å±ç•«é¢å±¤ */
        #lock-screen {
            position: fixed; inset: 0; background: #1a1c2c; display: flex; align-items: center; justify-content: center; z-index: 10000;
        }
        .login-card {
            background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); padding: 40px; border-radius: 30px; 
            box-shadow: 0 8px 32px rgba(0,0,0,0.3); text-align: center; width: 320px; border: 1px solid rgba(255,255,255,0.1);
        }
        .login-icon { background: #b0a496; width: 60px; height: 60px; border-radius: 50%; margin: 0 auto 20px; display: flex; align-items: center; justify-content: center; color: white; font-size: 24px; }
        .login-card h2 { color: white; margin: 0 0 10px; letter-spacing: 2px; }
        .login-card p { color: #888; font-size: 0.9em; margin-bottom: 25px; }
        .login-input { width: 100%; padding: 15px; border-radius: 12px; border: 1px solid #3d3d5c; background: #26263d; color: white; font-size: 1.2em; text-align: center; outline: none; box-sizing: border-box; }
        .login-btn { width: 100%; padding: 15px; margin-top: 20px; border-radius: 12px; border: none; background: var(--main-brown); color: white; font-weight: bold; font-size: 1.1em; cursor: pointer; }

        /* ä¸»ç¨‹å¼ä½ˆå±€ */
        header { background: var(--main-brown); color: white; padding: 12px; text-align: center; font-size: 1.3em; font-weight: bold; flex-shrink: 0; }
        .nav-bar { background: #e8e0d9; padding: 10px; display: flex; gap: 10px; overflow-x: auto; border-bottom: 2px solid #d1c7bc; flex-shrink: 0; }
        .nav-btn { background: white; border: 1px solid #d1c7bc; padding: 8px 18px; border-radius: 20px; cursor: pointer; white-space: nowrap; }
        .main-content { display: flex; flex: 1; overflow: hidden; padding: 10px; gap: 10px; }
        .item-area { flex: 1.8; overflow-y: auto; background: white; border-radius: 15px; padding: 15px; border: 2px solid #e8e0d9; }
        .product-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(130px, 1fr)); gap: 10px; }
        .p-btn { background: white; border: 1px solid #f0e6dd; border-radius: 12px; padding: 10px 5px; text-align: center; cursor: pointer; box-shadow: 2px 2px 0 #e8e0d9; min-height: 90px; display: flex; flex-direction: column; justify-content: center; }
        .checkout-area { flex: 1; display: flex; flex-direction: column; gap: 10px; min-width: 300px; }
        .card { background: white; border-radius: 15px; padding: 12px; border: 2px solid #e8e0d9; }
        .total-display { font-size: 3em; font-weight: bold; color: var(--price-red); text-align: right; margin: 10px 0; }
        #admin-panel, #history-panel { position: fixed; inset: 10px; background: white; z-index: 1000; border-radius: 20px; display: none; flex-direction: column; padding: 15px; border: 3px solid var(--main-brown); }
    </style>
</head>
<body>

<div id="lock-screen">
    <div class="login-card">
        <div class="login-icon">ğŸ§¸</div>
        <h2>LITTLE NOOK</h2>
        <p>OSSEN POS SYSTEM v2.0</p>
        <input type="password" id="pw-input" class="login-input" placeholder="è«‹è¼¸å…¥å¯†ç¢¼" autofocus>
        <button class="login-btn" onclick="checkUnlock()">ç¢ºèªé€²å…¥</button>
    </div>
</div>

<header>ğŸ§¸ LITTLE NOOK POS</header>
<div class="nav-bar" id="navbar"></div>

<div class="main-content">
    <div class="item-area" id="item-area">è®€å–ä¸­...</div>
    <div class="checkout-area">
        <div class="card">
            <strong>ğŸ›’ ç•¶å‰æ¸…å–®</strong>
            <div id="cart-list" style="max-height:200px; overflow-y:auto; margin:10px 0;"></div>
            <input type="number" id="discount" style="width:100%; padding:10px; box-sizing:border-box;" placeholder="æŠ˜æ‰£é‡‘é¡" oninput="calc()">
            <div class="total-display">$<span id="final-total">0</span></div>
            <button onclick="submitOrder()" style="width:100%; padding:20px; background:var(--profit-green); color:white; border:none; border-radius:15px; font-weight:bold; font-size:1.5em; cursor:pointer;">å®Œæˆçµå¸³</button>
        </div>
    </div>
</div>

<div style="padding:10px; text-align:center;">
    <button onclick="toggleAdmin()" style="padding:10px 20px;">ç®¡ç†å¾Œå°</button>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyDn6HtjYMz_FFKU9xjhvV1xXYPr7t36UU0",
        authDomain: "little-nook-aad58.firebaseapp.com",
        databaseURL: "https://little-nook-aad58-default-rtdb.firebaseio.com/", 
        projectId: "little-nook-aad58",
        storageBucket: "little-nook-aad58.appspot.com",
        messagingSenderId: "338959223363",
        appId: "1:338959223363:web:71e35d25959c9d57f131a3"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    let inv = []; let cart = [];

    function checkUnlock() {
        if (document.getElementById('pw-input').value === '0209') {
            document.getElementById('lock-screen').style.display = 'none';
        } else { alert("å¯†ç¢¼éŒ¯èª¤ï¼"); }
    }

    db.ref('inventory').on('value', snap => {
        inv = snap.val() || [];
        const area = document.getElementById('item-area');
        area.innerHTML = '';
        inv.forEach(cat => {
            let grid = `<div style="font-weight:bold; margin:10px 0; border-left:4px solid brown; padding-left:10px;">${cat.cat}</div><div class="product-grid">`;
            (cat.items || []).forEach(it => {
                grid += `<div class="p-btn" onclick="addCart('${it.id}')"><div>${it.n}</div><div style="color:brown">$${it.p}</div><div style="font-size:0.8em; color:gray">å­˜:${it.s}</div></div>`;
            });
            area.innerHTML += grid + '</div>';
        });
    });

    function addCart(id) {
        inv.forEach(c => (c.items || []).forEach(it => { if(it.id === id && it.s > 0) cart.push({...it}); }));
        renderCart();
    }
    function renderCart() {
        document.getElementById('cart-list').innerHTML = cart.map((it, i) => `<div>${it.n} $${it.p} <span onclick="cart.splice(${i},1);renderCart()" style="color:red">âœ•</span></div>`).join('');
        calc();
    }
    function calc() {
        const total = cart.reduce((a,b)=>a+b.p, 0) - (Number(document.getElementById('discount').value) || 0);
        document.getElementById('final-total').innerText = Math.max(0, total);
    }
    function submitOrder() {
        if(!cart.length) return;
        const total = Number(document.getElementById('final-total').innerText);
        const data = { t: new Date().toLocaleTimeString(), d: new Date().toLocaleDateString('zh-TW'), total, items: [...cart] };
        cart.forEach(it => inv.forEach(c => (c.items||[]).forEach(i => { if(i.id === it.id) i.s--; })));
        db.ref('orders').push(data).then(() => db.ref('inventory').set(inv)).then(() => {
            alert("çµå¸³æˆåŠŸï¼"); cart = []; renderCart();
        });
    }
    function toggleAdmin() { alert("ç®¡ç†åŠŸèƒ½è«‹åƒè€ƒå‰ä¸€ç‰ˆæœ¬ï¼Œæ­¤ç‰ˆæœ¬å„ªå…ˆä¿®å¾©é¡¯ç¤ºå•é¡Œã€‚"); }
</script>
</body>
</html>
