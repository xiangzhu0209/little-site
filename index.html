<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ğŸ§¸ è§’è½é›œè²¨èˆ– POS æœ€çµ‚ç‰ˆ</title>
    <style>
        :root { --main-brown: #b0a496; --bg-cream: #fcf8f5; --accent-brown: #8c7b6c; --price-red: #d9534f; --profit-green: #6b8e23; }
        body { font-family: sans-serif; background: var(--bg-cream); margin: 0; display: flex; flex-direction: column; height: 100vh; color: #5d5246; overflow: hidden; }
        header { background: var(--main-brown); color: white; padding: 12px; text-align: center; font-size: 1.3em; font-weight: bold; flex-shrink: 0; }
        .nav-bar { background: #e8e0d9; padding: 10px; display: flex; gap: 10px; overflow-x: auto; border-bottom: 2px solid #d1c7bc; flex-shrink: 0; }
        .nav-btn { background: white; border: 1px solid #d1c7bc; padding: 6px 15px; border-radius: 20px; white-space: nowrap; cursor: pointer; font-size: 0.85em; }
        
        .main-content { display: flex; flex: 1; overflow: hidden; padding: 10px; gap: 10px; }
        .item-area { flex: 2; overflow-y: auto; background: white; border-radius: 15px; padding: 15px; border: 2px solid #e8e0d9; }
        .cat-title { background: #fdf5f0; padding: 6px 15px; border-radius: 20px; margin: 15px 0 8px; font-weight: bold; border-left: 6px solid var(--main-brown); font-size: 0.9em; }
        .product-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(105px, 1fr)); gap: 8px; }
        
        .p-btn { background: white; border: 1px solid #f0e6dd; border-radius: 12px; padding: 8px 5px; text-align: center; cursor: pointer; box-shadow: 2px 2px 0 #e8e0d9; min-height: 60px; display: flex; flex-direction: column; justify-content: center; }
        .p-btn.sold-out { opacity: 0.4; background: #eee; cursor: not-allowed; }
        .p-btn.discontinued { background: #ffebeb; border: 1px dashed #d9534f; color: #999; }
        .p-name { font-size: 0.75em; font-weight: bold; margin-bottom: 3px; line-height: 1.2; overflow: hidden; text-overflow: ellipsis; }
        .p-price { color: #c2966d; font-size: 0.9em; font-weight: bold; }
        .p-stock { font-size: 0.7em; color: #999; }

        .checkout-area { flex: 1; display: flex; flex-direction: column; gap: 10px; min-width: 320px; }
        .card { background: white; border-radius: 15px; padding: 12px; border: 2px solid #e8e0d9; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        #cart-list { max-height: 200px; overflow-y: auto; border-bottom: 2px dashed #e8e0d9; margin-bottom: 8px; }
        .cart-item { display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px; font-size: 0.85em; background: #fafafa; padding: 5px; border-radius: 5px; }
        
        .pay-method-box { display: flex; gap: 5px; margin: 10px 0; }
        .pay-btn { flex: 1; padding: 8px; border-radius: 8px; border: 1px solid #ccc; background: white; cursor: pointer; font-size: 0.85em; }
        .pay-btn.active { background: var(--accent-brown); color: white; border-color: var(--accent-brown); }

        .change-box { background: #fdfaf0; padding: 10px; border-radius: 10px; margin-top: 5px; font-size: 0.9em; border: 1px solid #faebcc; }
        .total-display { font-size: 2.2em; font-weight: bold; color: var(--price-red); text-align: right; }
        .done-btn { background: var(--profit-green); color: white; border: none; width: 100%; padding: 12px; border-radius: 10px; font-size: 1.2em; font-weight: bold; cursor: pointer; margin-top: 10px; }

        #admin-panel { position: fixed; top: 10px; left: 10px; right: 10px; bottom: 10px; background: white; z-index: 1000; border-radius: 20px; box-shadow: 0 0 30px rgba(0,0,0,0.5); display: none; flex-direction: column; padding: 15px; border: 3px solid var(--main-brown); }
        .admin-table-container { flex: 1; overflow: auto; margin-top: 10px; }
        table { width: 100%; border-collapse: collapse; font-size: 0.75em; }
        th, td { border: 1px solid #ddd; padding: 6px; text-align: left; }
        .secret-stats { display: flex; gap: 10px; margin-bottom: 15px; }
    </style>
</head>
<body>

<header>ğŸ§¸ è§’è½é›œè²¨èˆ– POS</header>
<div class="nav-bar" id="navbar"></div>

<div class="main-content">
    <div class="item-area" id="item-area"></div>
    <div class="checkout-area">
        <div class="card">
            <strong>ğŸ›’ è³¼ç‰©è»Š</strong>
            <div id="cart-list"></div>
            <div style="display:flex; justify-content:space-between; align-items:center; margin-top:10px;">
                <span>æŠ˜æ‰£: <input type="number" id="discount" style="width:50px; padding:3px;" oninput="calc()"></span>
                <span class="total-display">$<span id="final-total">0</span></span>
            </div>
            
            <div class="pay-method-box">
                <button class="pay-btn active" id="btn-cash" onclick="setPay('ç¾é‡‘')">ğŸ’µ ç¾é‡‘</button>
                <button class="pay-btn" id="btn-elec" onclick="setPay('é›»æ”¯')">ğŸ“± é›»æ”¯</button>
            </div>

            <div class="change-box" id="cash-calc-area">
                æ”¶: <input type="number" id="cash-in" placeholder="è¼¸å…¥é‡‘é¡" style="width:80px; font-size:1.1em; padding:3px;" oninput="calcChange()"> 
                æ‰¾é›¶: <span id="cash-change" style="color:var(--price-red); font-weight:bold; font-size:1.3em; margin-left:10px;">0</span>
            </div>

            <button class="done-btn" onclick="submitOrder()">âœ¨ çµå¸³å®Œæˆ</button>
        </div>

        <div class="card" style="flex:1; overflow:hidden; display:flex; flex-direction:column;">
            <strong>ğŸ“‹ æœ€è¿‘ç´€éŒ„</strong>
            <div id="order-log" style="flex:1; overflow-y:auto; font-size:0.8em; margin-top:8px;"></div>
            <button onclick="syncToCloud()" style="width:100%; margin-top:5px; background:#5bc0de; color:white; border:none; padding:8px; border-radius:5px; cursor:pointer;">é›²ç«¯åŒæ­¥</button>
        </div>
    </div>
</div>

<div style="padding:10px; background:#eee; text-align:center;">
    <button onclick="toggleAdmin()" style="padding:10px 30px; border-radius:10px; background:var(--accent-brown); color:white; border:none; font-weight:bold;">ğŸ› ï¸ åº—é•·å¾Œå° (åˆ©æ½¤/åº«å­˜)</button>
</div>

<div id="admin-panel">
    <div style="display:flex; justify-content:space-between; align-items:center;">
        <h3>ğŸ› ï¸ åº—é•·ç®¡ç†å¾Œå°</h3>
        <button onclick="toggleAdmin()" style="background:#666; color:white; border:none; padding:8px 15px; border-radius:8px;">âœ• é—œé–‰</button>
    </div>

    <div class="secret-stats">
        <div style="flex:1; background:#fff5f5; padding:15px; border-radius:12px; text-align:center; border:2px solid #ffebeb;">
            <div style="font-size:0.85em; color:#999;">ä»Šæ—¥ç¸½ç‡Ÿæ”¶</div>
            <div style="font-size:1.8em; color:var(--price-red); font-weight:bold;">$<span id="stat-revenue">0</span></div>
        </div>
        <div style="flex:1; background:#f5fff5; padding:15px; border-radius:12px; text-align:center; border:2px solid #ebffeb;">
            <div style="font-size:0.85em; color:#999;">ä»Šæ—¥ç¸½åˆ©æ½¤ (ç§˜å¯†)</div>
            <div style="font-size:1.8em; color:var(--profit-green); font-weight:bold;">$<span id="stat-profit">0</span></div>
        </div>
    </div>

    <div class="admin-table-container">
        <table id="admin-table">
            <thead><tr><th>ç·¨è™Ÿ</th><th>å“å</th><th>é€²åƒ¹</th><th>å”®åƒ¹</th><th>åº«å­˜</th></tr></thead>
            <tbody id="admin-tbody"></tbody>
        </table>
    </div>
    <div style="margin-top:15px; text-align:right;">
        <button onclick="saveAdminData()" style="background:var(--price-red); color:white; border:none; padding:12px 30px; border-radius:10px; font-weight:bold;">ğŸ’¾ å„²å­˜æ‰€æœ‰ä¿®æ”¹</button>
    </div>
</div>

<script>
    // å®Œæ•´ 150+ ç­†æ•¸æ“šç²¾ç¢ºå°è£
    const initialInventory = [
        { cat: "A åŒ…åŒ…å€", items: [
            {n:"A01 é‡ç¹”æ‰˜ç‰¹åŒ…(é»ƒé¬±é‡‘é¦™)",c:15,p:79,s:2},{n:"A02 é‡ç¹”æ‰˜ç‰¹åŒ…(ç±³è‰²å°ç™½ç‹—)",c:15,p:79,s:1},{n:"A03 æ³¢é»å°ç‹—åŒ–å¦åŒ…",c:30,p:99,s:2},{n:"A04 insè´è¶çµçšºè‚©åŒ…(éŠ€)",c:85,p:199,s:0,dis:true},{n:"A05 insè´è¶çµçšºè‚©åŒ…(è—)",c:85,p:199,s:1},{n:"A06 å¾©å¤æ‰‹æä¿é½¡çƒåŒ…(å’–)",c:100,p:249,s:1},{n:"A07 è±¹ç´‹æ‰‹æå°å»¢åŒ…(å’–)",c:80,p:149,s:1},{n:"A08 ç´ é¢æ–œèƒ¯çšºè‚©åŒ…(éŠ€)",c:90,p:199,s:1},{n:"A09 ç´ é¢æ–œèƒ¯çšºè‚©åŒ…(ç™½)",c:90,p:199,s:1},{n:"A10 æ³•å¼æœˆç‰™è…‹ä¸‹åŒ…(é»‘)",c:85,p:199,s:1},{n:"A11 æ³•å¼æœˆç‰™è…‹ä¸‹åŒ…(ç™½)",c:85,p:199,s:2},{n:"A12 é›²æœµè¿·ä½ æ‰‹æåŒ…(ç™½)",c:70,p:139,s:2},{n:"A13 é›²æœµè¿·ä½ æ‰‹æåŒ…(é»‘)",c:70,p:139,s:2},{n:"A14 å¾©å¤äº®çš®æ‰‹ææ–œèƒ¯åŒ…(é»‘)",c:140,p:249,s:0},{n:"A15 å°ç‹—æŠ˜ç–ŠåŒ–å¦åŒ…",c:55,p:99,s:1},{n:"A16 å¡å…¶è±¹ç´‹å°æ–¹åŒ…",c:55,p:139,s:1},{n:"A17 ç·¨ç¹”æœˆç‰™è…‹ä¸‹åŒ…(ç²‰ç´…)",c:95,p:199,s:1},{n:"A18 æ³•å¼è·³è‰²æœˆç‰™è…‹ä¸‹åŒ…(ç±³ç™½)",c:70,p:199,s:2},{n:"A19 Y2KéŠæ¢é›™è‚©åŒ…",c:90,p:199,s:1},{n:"A20 JKé¢¨æ—¥ç³»éƒµå·®åŒ…(å’–)",c:120,p:289,s:1},{n:"A21 æ¼†çš®æ³•æ£è…‹ä¸‹åŒ…(é»‘)",c:90,p:199,s:2},{n:"A22 çç é›™éŠæ¢è…‹ä¸‹åŒ…(ç²‰)",c:65,p:249,s:1},{n:"A23 çç é›™éŠæ¢è…‹ä¸‹åŒ…(ç™½)",c:65,p:249,s:1},{n:"A24 æ³•åœ‹å°çœ¾æ–¹å½¢è…‹ä¸‹åŒ…(é»‘)",c:60,p:199,s:2},{n:"A25 æ³•åœ‹å°çœ¾æ–¹å½¢è…‹ä¸‹åŒ…(ç´…æ£•)",c:60,p:199,s:2},{n:"A26 å¤§å®¹é‡ä¿é½¡çƒåŒ…(å’–)",c:80,p:289,s:1},{n:"A27 è•¾çµ²èŠ±é‚Šå¾ŒèƒŒåŒ…(é»‘)",c:70,p:199,s:1},{n:"A28 è•¾çµ²èŠ±é‚Šå¾ŒèƒŒåŒ…(ç²‰)",c:70,p:199,s:1},{n:"A29 éŸ“ç³»è¤¶çšºé›²æœµåŒ…",c:65,p:199,s:0},{n:"A30 é‡ç¹”ææ‰‹åŒ…(çœ¼é¡ç‹—)",c:65,p:139,s:2},{n:"A31 é‡ç¹”ææ‰‹åŒ…(ç´…æ ¼ç‹—)",c:65,p:139,s:2}
        ]},
        { cat: "B ç”Ÿæ´»å°ç‰©", items: [
            {n:"B01 è¿·ä½ ç£å¸å°æª¯ç‡ˆ(è—)",c:30,p:79,s:3},{n:"B02 è¿·ä½ ç£å¸å°æª¯ç‡ˆ(ç¶ )",c:30,p:79,s:3},{n:"B03 ç« é­šæš–å…‰ç‡ˆ(è—)",c:40,p:89,s:2},{n:"B04 ç« é­šæš–å…‰ç‡ˆ(é»ƒ)",c:40,p:89,s:2},{n:"B05 é¬±é‡‘é¦™å°å£å¤¾(é»ƒ)",c:15,p:69,s:2},{n:"B06 é¬±é‡‘é¦™å°å£å¤¾(ç²‰)",c:15,p:69,s:2},{n:"B07 ä¸ƒå±¤æ¼¢å ¡å¡‘è† ç›¤",c:35,p:129,s:2},{n:"B08 é»ƒè‰²çœ¼ç›åŒ–å¦é¡",c:25,p:99,s:2},{n:"B09 ç²‰è‰²çœ¼ç›åŒ–å¦é¡",c:25,p:99,s:2},{n:"B10 ä¸™çƒ¯é¦¬å…‹ç­†(12è‰²)",c:40,p:99,s:2},{n:"B11 ä¸™çƒ¯é¦¬å…‹ç­†(48è‰²)",c:150,p:259,s:1},{n:"B12 ä¾¿åˆ©åº—å­˜éŒ¢ç½",c:85,p:159,s:1},{n:"B13 å»£è§’é¡æ‰‹æ©Ÿæ”¯æ¶",c:40,p:99,s:6},{n:"B14 å°éº¥éº¥è€³æ©Ÿå¸½",c:30,p:89,s:1},{n:"B15 å¤šå·´èƒºè¨ˆç®—æ©Ÿ(é»ƒ)",c:45,p:99,s:1},{n:"B16 å¤šå·´èƒºè¨ˆç®—æ©Ÿ(ç´«)",c:45,p:99,s:1},{n:"B17 å¤šå·´èƒºè¨ˆç®—æ©Ÿ(ç™½)",c:45,p:99,s:1},{n:"B18 é›²æœµé¡",c:15,p:49,s:1},{n:"B19-24 é¦™æ°›è Ÿç‡­ç³»åˆ—",c:20,p:99,s:4},{n:"B25-27 æ‰‹æ©Ÿæ°£å›Šç³»åˆ—",c:10,p:59,s:2},{n:"B28-29 æ‰‹ææŠ±æ•æ¯¯",c:135,p:249,s:1},{n:"B30 èƒ¡è˜¿è””éŒ„éŸ³ç­†",c:30,p:69,s:4},{n:"B31 å¯é Œæ›å‹¾",c:65,p:99,s:8}
        ]},
        { cat: "C æ“¦æ‰‹å·¾", items: [
            {n:"C01 é›¨å‚˜æ“¦æ‰‹å·¾",c:20,p:79,s:1},{n:"C02 ç´…è‰²è˜‘è‡æ‰‹å·¾",c:21,p:79,s:2},{n:"C03 è—å¸½å­å°ç‹—æ‰‹å·¾",c:33,p:99,s:2},{n:"C04 éº¥ç•¶è²“æ“¦æ‰‹å·¾",c:38,p:99,s:1},{n:"C05 æµ·æ˜Ÿæ“¦æ‰‹å·¾",c:33,p:99,s:2},{n:"C06 æ°´æ¯æ“¦æ‰‹å·¾",c:33,p:99,s:2},{n:"C07-09 åŠ å¤§æ¬¾æ“¦æ‰‹å·¾",c:33,p:129,s:2},{n:"C10 å’–å•¡å°ç‹—æ“¦æ‰‹å·¾",c:15,p:99,s:2},{n:"C11-13 ç³»åˆ—ç‹—æ“¦æ‰‹å·¾",c:18,p:99,s:2},{n:"C14 ç·šæ¢ç‹—æ“¦æ‰‹å·¾",c:30,p:99,s:1},{n:"C15 æ˜Ÿæ˜Ÿäººæ“¦æ‰‹å·¾",c:20,p:99,s:0,dis:true},{n:"C16-19 é€ å‹å°ç‹—æ“¦æ‰‹å·¾",c:20,p:99,s:2}
        ]},
        { cat: "D é«®é£¾é¤¨", items: [
            {n:"D01/02 ç£¨ç ‚ç„¡ç—•å¤¾",c:20,p:49,s:2},{n:"D03 æ³¢ç´‹å¥¶ç³–é¯Šé­šå¤¾",c:30,p:69,s:1},{n:"D04 èŠ±é‚Šå°é«®åœˆ",c:10,p:29,s:3},{n:"D05 å¸ƒé¢è±¹ç´‹ç„¡ç—•å¤¾",c:30,p:69,s:0,dis:true},{n:"D06-07 æ«»æ¡ƒèŠ±æœµ/å¤§è…¸åœˆ",c:35,p:79,s:1},{n:"D08-09 æ¯›æ¯›é¯Šé­šå¤¾",c:25,p:69,s:1},{n:"D10 æ„›å¿ƒé‘½ç„¡ç—•å¤¾",c:45,p:69,s:1},{n:"D11 çµ¨é¢æ„›å¿ƒæ°´æ»´å¤¾",c:33,p:69,s:1},{n:"D13 è´è¶çµæ ¼å­å°å¤¾",c:22,p:69,s:3},{n:"D16 è—æ¢ç´‹å¥¶æ²¹èŠ±é‚Šåœˆ",c:30,p:79,s:1},{n:"D21 å¤§è™Ÿè±¹ç´‹é¯Šé­šå¤¾(å’–)",c:25,p:69,s:2},{n:"D24 çç è´è¶çµç„¡ç—•å¤¾",c:30,p:79,s:2},{n:"D26 æ ¼ç´‹æ‰‡å½¢é¯Šé­šå¤¾",c:35,p:79,s:2},{n:"D31/32 å½ˆåŠ›é«®åœˆç½è£",c:10,p:49,s:2},{n:"D33 æ°´æ»´BBå¤¾(10å…¥)",c:5,p:29,s:8},{n:"D34 å¤§è™Ÿè±¹ç´‹é¯Šé­šå¤¾(ç°)",c:25,p:69,s:2},{n:"D35 çç æ«»æ¡ƒç„¡ç—•å¤¾",c:30,p:79,s:3},{n:"D37-39 ç´ å’–è±¹ç´‹å¤¾ç³»åˆ—",c:25,p:59,s:1}
        ]},
        { cat: "E å¨ƒå¨ƒ/æ›ä»¶", items: [
            {n:"E01 ç•«å®¶è¥¿é«˜åœ°(å’–)",c:60,p:99,s:1},{n:"E02-07 è¥¿é«˜åœ°è£æ‰®ç³»åˆ—",c:75,p:129,s:0},{n:"E08/09 é•·æ¯›å°æ€ªç¸",c:90,p:199,s:1},{n:"E10-11 éº¥ç•¶è²“å°æ›ä»¶",c:12,p:39,s:3},{n:"E12 åœ“é»å°ç‹—æ›ä»¶",c:15,p:49,s:3},{n:"E13-15 é¬±é‡‘é¦™æ›ä»¶",c:12,p:39,s:3},{n:"E16 ææ€ªé†œèŒèŠ±æœµ",c:13,p:49,s:5},{n:"E17 è£æ‰®æ€•æ´½ç‹—",c:38,p:79,s:1},{n:"E18 è–‘é¤…äºº",c:15,p:39,s:0,dis:true},{n:"E19 è–èª•æ¨¹æ›ä»¶",c:15,p:39,s:2},{n:"E20-21 ææ€ªå°å¼·æ›ä»¶",c:10,p:39,s:3},{n:"E22-23 æŠ½æ‹‰å…”å­",c:60,p:129,s:2},{n:"E24 ä¸€æ¢ç‹—",c:42,p:99,s:5}
        ]},
        { cat: "F/G/H å€", items: [
            {n:"F01-18 å„å¼ç²¾é¸è¥ªå­",c:20,p:59,s:2},{n:"F19-23 ç²¾é¸åœå·¾ç³»åˆ—",c:80,p:239,s:2},{n:"G01 316ä¸é½é‹¼å¸ç®¡æ¯",c:130,p:239,s:3},{n:"G02-05 é€ å‹æ¹¯åŒ™å‰å­",c:55,p:99,s:4},{n:"G06-07 å¡çš®å·´æ‹‰ç­·å­",c:25,p:59,s:5},{n:"G12 8å‹è–¯æ¢ç›¤",c:40,p:99,s:2},{n:"G13-17 é€ å‹ç›¤ç³»åˆ—",c:50,p:129,s:2},{n:"H01-09 é¦¬å¹´/è²¡æºç´…åŒ…(5å…¥)",c:6,p:39,s:5},{n:"H13-20 é€ å‹ç´…åŒ…(6å…¥)",c:9,p:49,s:3}
        ]}
    ];

    let currentInv = JSON.parse(localStorage.getItem('pos_2026_vFinal')) || initialInventory;
    let orders = JSON.parse(localStorage.getItem('pos_his_vFinal')) || [];
    let cart = [];
    let currentPay = 'ç¾é‡‘';

    function init() {
        const area = document.getElementById('item-area'), nav = document.getElementById('navbar');
        area.innerHTML = ''; nav.innerHTML = '';
        currentInv.forEach((cat, idx) => {
            const id = 'c' + idx;
            nav.innerHTML += `<div class="nav-btn" onclick="document.getElementById('${id}').scrollIntoView()">${cat.cat}</div>`;
            let html = `<div class="cat-title" id="${id}">${cat.cat}</div><div class="product-grid">`;
            cat.items.forEach(it => {
                const cls = it.dis ? 'discontinued' : (it.s <= 0 ? 'sold-out' : '');
                html += `<div class="p-btn ${cls}" onclick="addCart('${it.n}',${it.p},${it.c},${it.s},${it.dis||false})">
                    <div class="p-name">${it.n}</div>
                    <div class="p-price">$${it.p}</div>
                    <div class="p-stock">${it.dis?'åœå”®':(it.s<=0?'å®Œå”®':'å­˜:'+it.s)}</div>
                </div>`;
            });
            area.innerHTML += html + '</div>';
        });
        updateOrderLog();
    }

    function addCart(n, p, c, s, dis) {
        if(dis) return alert("æ­¤å“é …å·²åœå”®");
        if(s <= 0) return alert("å®Œå”®åº«å­˜ä¸è¶³");
        cart.push({n, p, c});
        renderCart();
    }

    function renderCart() {
        const list = document.getElementById('cart-list');
        list.innerHTML = cart.map((it, i) => `
            <div class="cart-item">
                <span>${it.n}</span>
                <b style="color:var(--price-red);">$${it.p}</b>
                <span style="color:#ccc; cursor:pointer;" onclick="cart.splice(${i},1);renderCart();">âœ•</span>
            </div>
        `).join('');
        calc();
    }

    function setPay(m) {
        currentPay = m;
        document.getElementById('btn-cash').classList.toggle('active', m==='ç¾é‡‘');
        document.getElementById('btn-elec').classList.toggle('active', m==='é›»æ”¯');
        document.getElementById('cash-calc-area').style.display = (m==='ç¾é‡‘') ? 'block' : 'none';
    }

    function calc() {
        const sub = cart.reduce((a, b) => a + b.p, 0);
        const disc = Number(document.getElementById('discount').value || 0);
        document.getElementById('final-total').innerText = Math.max(0, sub - disc);
        calcChange();
    }

    function calcChange() {
        const total = Number(document.getElementById('final-total').innerText);
        const input = Number(document.getElementById('cash-in').value || 0);
        document.getElementById('cash-change').innerText = (input > total) ? (input - total) : 0;
    }

    function submitOrder() {
        if(!cart.length) return;
        const total = Number(document.getElementById('final-total').innerText);
        const disc = Number(document.getElementById('discount').value || 0);
        const cost = cart.reduce((a,b) => a+b.c, 0);
        const profit = total - cost;

        // æ‰£åº«å­˜
        cart.forEach(ci => {
            currentInv.forEach(cat => cat.items.forEach(it => { if(it.n === ci.n) it.s--; }));
        });

        orders.unshift({
            time: new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'}),
            date: new Date().toLocaleDateString(),
            total, profit, detail: `[${currentPay}] ` + cart.map(i=>i.n).join(','),
            sync: 0
        });

        cart = []; document.getElementById('discount').value = ''; 
        document.getElementById('cash-in').value = '';
        localStorage.setItem('pos_2026_vFinal', JSON.stringify(currentInv));
        localStorage.setItem('pos_his_vFinal', JSON.stringify(orders));
        renderCart(); init();
        alert("çµå¸³æˆåŠŸï¼");
    }

    function updateOrderLog() {
        const today = new Date().toLocaleDateString();
        const tOrders = orders.filter(o => o.date === today);
        document.getElementById('stat-revenue').innerText = tOrders.reduce((a,b)=>a+b.total, 0);
        document.getElementById('stat-profit').innerText = tOrders.reduce((a,b)=>a+b.profit, 0);

        document.getElementById('order-log').innerHTML = orders.slice(0, 20).map(o => `
            <div style="border-bottom:1px solid #eee; padding:5px 0;">
                <div style="display:flex; justify-content:space-between;"><b>$${o.total}</b> <span>${o.time}</span></div>
                <div style="font-size:0.8em; color:#888;">${o.detail}</div>
            </div>
        `).join('');
    }

    function toggleAdmin() {
        const p = document.getElementById('admin-panel');
        if(p.style.display === 'flex') p.style.display = 'none';
        else {
            const tbody = document.getElementById('admin-tbody');
            tbody.innerHTML = '';
            currentInv.forEach(cat => cat.items.forEach(it => {
                tbody.innerHTML += `<tr>
                    <td>${it.n.split(' ')[0]}</td>
                    <td>${it.n}</td>
                    <td>${it.c}</td>
                    <td>${it.p}</td>
                    <td><input type="number" value="${it.s}" style="width:40px;" onchange="it.s=Number(this.value)"></td>
                </tr>`;
            }));
            p.style.display = 'flex';
        }
    }

    function saveAdminData() {
        localStorage.setItem('pos_2026_vFinal', JSON.stringify(currentInv));
        init(); toggleAdmin(); alert("åº«å­˜å·²åŒæ­¥ï¼");
    }

    async function syncToCloud() {
        alert("åŒæ­¥åŠŸèƒ½å·²é å‚™ï¼Œè«‹ç¢ºèª Google Forms é€£çµæ­£ç¢ºã€‚");
    }

    init();
</script>
</body>
</html>
