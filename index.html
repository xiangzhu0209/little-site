ä½ æ€éº¼æ²’æœ‰åšå¯æ„›ä¸€é»
æˆ‘ç†æƒ³ä¸­æ˜¯é€™æ¨£çš„æ’ç‰ˆã„Ÿ
<!DOCTYPE html>
<html lang="zh-TW">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
Â  Â  <title>ğŸ§¸ LITTLE NOOK POS (Pro é€²éšå¼·åŒ–ç‰ˆ)</title>
Â  Â  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
Â  Â  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
Â  Â  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
Â  Â Â 
Â  Â  <style>
Â  Â  Â  Â  :root { --main-brown: #b0a496; --bg-cream: #fcf8f5; --accent-brown: #8c7b6c; --price-red: #d9534f; --profit-green: #6b8e23; }
Â  Â  Â  Â  /* åˆå§‹éš±è— body å…§å®¹ï¼Œé˜²æ­¢å¯†ç¢¼è¼¸å…¥å‰é–ƒéå…§å®¹ */
Â  Â  Â  Â  body { font-family: sans-serif; background: var(--bg-cream); margin: 0; display: none; flex-direction: column; height: 100vh; color: #5d5246; overflow: hidden; }
Â  Â  Â  Â  header { background: var(--main-brown); color: white; padding: 12px; text-align: center; font-size: 1.3em; font-weight: bold; flex-shrink: 0; }
Â  Â  Â  Â  .nav-bar { background: #e8e0d9; padding: 10px; display: flex; gap: 10px; overflow-x: auto; border-bottom: 2px solid #d1c7bc; flex-shrink: 0; align-items: center; }
Â  Â  Â  Â  .nav-btn { background: white; border: 1px solid #d1c7bc; padding: 8px 18px; border-radius: 20px; white-space: nowrap; cursor: pointer; font-size: 1.1em; }
Â  Â  Â  Â  .sync-btn { background: #ff9800; color: white; border: none; padding: 8px 15px; border-radius: 20px; font-weight: bold; cursor: pointer; margin-left: auto; }
Â  Â  Â  Â  .main-content { display: flex; flex: 1; overflow: hidden; padding: 10px; gap: 10px; }
Â  Â  Â  Â  .item-area { flex: 1.8; overflow-y: auto; background: white; border-radius: 15px; padding: 15px; border: 2px solid #e8e0d9; }
Â  Â  Â  Â  .cat-title { background: #fdf5f0; padding: 8px 15px; border-radius: 20px; margin: 15px 0 8px; font-weight: bold; border-left: 8px solid var(--main-brown); font-size: 1.2em; }
Â  Â  Â  Â  .product-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(135px, 1fr)); gap: 10px; }
Â  Â  Â  Â  .p-btn { background: white; border: 1px solid #f0e6dd; border-radius: 12px; padding: 10px 5px; text-align: center; cursor: pointer; box-shadow: 2px 2px 0 #e8e0d9; min-height: 90px; display: flex; flex-direction: column; justify-content: center; }
Â  Â  Â  Â  .p-name { font-size: 0.85em; font-weight: bold; margin-bottom: 5px; height: 2.8em; overflow: hidden; line-height: 1.4; }
Â  Â  Â  Â  .p-price { color: #c2966d; font-size: 1.2em; font-weight: bold; }
Â  Â  Â  Â  .p-stock { font-size: 0.8em; color: #999; }
Â  Â  Â  Â  .checkout-area { flex: 1; display: flex; flex-direction: column; gap: 10px; min-width: 320px; overflow-y: auto; }
Â  Â  Â  Â  .card { background: white; border-radius: 15px; padding: 12px; border: 2px solid #e8e0d9; }
Â  Â  Â  Â  #cart-list { max-height: 200px; overflow-y: auto; border-bottom: 2px dashed #e8e0d9; }
Â  Â  Â  Â  .cart-item { display: flex; justify-content: space-between; align-items: center; padding: 12px 5px; font-size: 1.1em; border-bottom: 1px solid #eee; }
Â  Â  Â  Â  .big-input { font-size: 1.8em; padding: 12px; width: 100%; border-radius: 10px; border: 2px solid #d1c7bc; text-align: right; box-sizing: border-box; background: #fffcf5; font-weight: bold; }
Â  Â  Â  Â  .small-note { font-size: 1em; padding: 8px; width: 100%; border-radius: 8px; border: 1px solid #d1c7bc; box-sizing: border-box; margin-top: 5px; }
Â  Â  Â  Â  .total-display { font-size: 3.2em; font-weight: bold; color: var(--price-red); text-align: right; margin: 10px 0; }
Â  Â  Â  Â  .pay-btn { flex: 1; padding: 15px; border-radius: 10px; border: 1px solid #ccc; background: white; cursor: pointer; font-weight: bold; font-size: 1.3em;}
Â  Â  Â  Â  .pay-btn.active { background: var(--accent-brown); color: white; border-color: var(--accent-brown); }
Â  Â  Â  Â  #admin-panel, #history-panel { position: fixed; inset: 10px; background: white; z-index: 1000; border-radius: 20px; display: none; flex-direction: column; padding: 15px; border: 3px solid var(--main-brown); box-shadow: 0 0 50px rgba(0,0,0,0.3); }
Â  Â  Â  Â  .admin-layout { display: grid; grid-template-columns: 1.5fr 1fr; gap: 15px; flex: 1; overflow: hidden; }
Â  Â  Â  Â  .add-row-top { background: #f0fdf4; padding: 15px; border: 2px solid var(--profit-green); border-radius: 15px; display: flex; gap: 10px; align-items: center; flex-wrap: wrap; margin-bottom: 10px; }
Â  Â  Â  Â  .admin-table-container { overflow: auto; border: 1px solid #eee; border-radius: 8px; }
Â  Â  Â  Â  <table> width: 100%; border-collapse: collapse; }
Â  Â  Â  Â  th { background: #f4f4f4; position: sticky; top: 0; padding: 10px; border: 1px solid #ddd; z-index: 5; }
Â  Â  Â  Â  td { padding: 8px; border: 1px solid #ddd; text-align: center; }
Â  Â  Â  Â  .del-x { color: red; font-weight: bold; cursor: pointer; font-size: 1.4em; }
Â  Â  Â  Â  .order-tag { background: #eee; padding: 2px 6px; border-radius: 4px; font-size: 0.8em; margin-right: 4px; color: #666; display: inline-block; margin-top: 4px; border: 1px solid #ddd; }
Â  Â  Â  Â  .admin-input-large { font-size: 1.2em !important; padding: 8px !important; width: 100%; box-sizing: border-box; }
Â  Â  Â  Â  .history-card { background: #fdfdfd; border: 1px solid #eee; padding: 10px; border-radius: 8px; margin-bottom: 10px; position: relative; }
Â  Â  Â  Â  .history-del-btn { position: absolute; top: 10px; right: 10px; color: red; cursor: pointer; font-weight: bold; border: 1px solid red; padding: 2px 5px; border-radius: 4px; font-size: 0.8em; }
Â  Â  Â  Â  .clear-log-btn { background: none; border: 1px solid #b0a496; color: #b0a496; font-size: 0.75em; padding: 2px 8px; border-radius: 5px; cursor: pointer; }
Â  Â  Â  Â  .cat-action-btn { font-size: 0.7em; margin-left: 10px; padding: 2px 6px; background: white; border: 1px solid #ccc; border-radius: 4px; cursor: pointer; vertical-align: middle; }
Â  Â  </style>
</head>
<body>

<header>ğŸ§¸ LITTLE NOOK POS (Pro é€²éšå¼·åŒ–ç‰ˆ)</header>
<div class="nav-bar">
Â  Â  <div id="navbar" style="display:flex; gap:10px;"></div>
Â  Â  <button class="sync-btn" onclick="syncOfflineData()">ğŸ”„ é›¢ç·šæ•¸æ“šåŒæ­¥</button>
</div>

<div class="main-content">
Â  Â  <div class="item-area" id="item-area">åŒæ­¥ä¸­...</div>
Â  Â  <div class="checkout-area">
Â  Â  Â  Â  <div class="card">
Â  Â  Â  Â  Â  Â  <strong>ğŸ›’ ç•¶å‰æ¸…å–®</strong>
Â  Â  Â  Â  Â  Â  <div id="cart-list"></div>
Â  Â  Â  Â  Â  Â  <div style="margin-top:10px;">
Â  Â  Â  Â  Â  Â  Â  Â  <input type="number" id="discount" class="big-input" placeholder="æŠ˜æ‰£é‡‘é¡" oninput="calc()">
Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="discount-note" class="small-note" placeholder="æŠ˜æ‰£åŸå› /å‚™è¨» (ä¾‹å¦‚: æ»¿é¡è´ˆ)">
Â  Â  Â  Â  Â  Â  Â  Â  <div style="margin-top:5px; display:flex; gap:5px;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="addExtraCost()" style="flex:1; padding:8px; background:#fef2f2; border:1px solid #fecaca; color:#b91c1c; border-radius:8px; cursor:pointer; font-size:0.9em; font-weight:bold;">â• ç´€éŒ„é¡å¤–æ”¯å‡º (æ‰£é™¤åˆ©æ½¤)</button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="total-display">$<span id="final-total">0</span></div>
Â  Â  Â  Â  Â  Â  <div style="display:flex; gap:8px; margin-bottom:10px;">
Â  Â  Â  Â  Â  Â  Â  Â  <button class="pay-btn active" id="btn-cash" onclick="setPay('ç¾é‡‘')">ğŸ’µ ç¾é‡‘</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button class="pay-btn" id="btn-elec" onclick="setPay('é›»æ”¯')">ğŸ“± é›»æ”¯</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <input type="number" id="cash-in" class="big-input" placeholder="å¯¦æ”¶é‡‘é¡" oninput="calcChange()">Â 
Â  Â  Â  Â  Â  Â  <div style="text-align:right; margin-top:5px; font-size: 1.3em;">æ‰¾é›¶: <span id="cash-change" style="font-weight:bold; color:red; font-size:1.8em;">0</span></div>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <div style="margin: 10px 0; padding: 10px; background: #fff5eb; border-radius: 10px; border: 1px dashed var(--main-brown);">
Â  Â  Â  Â  Â  Â  Â  Â  <label style="font-size: 0.9em; cursor: pointer;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="checkbox" id="backdate-mode" onclick="document.getElementById('manual-date').style.display = this.checked ? 'inline-block' : 'none'">Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ğŸ“… è£œç™»éå»æ—¥æœŸè³‡æ–™
Â  Â  Â  Â  Â  Â  Â  Â  </label>
Â  Â  Â  Â  Â  Â  Â  Â  <input type="date" id="manual-date" style="display:none; margin-left:10px; padding:5px; border:1px solid #ccc; border-radius:5px;">
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <button onclick="submitOrder()" style="width:100%; padding:20px; margin-top:15px; background:var(--profit-green); color:white; border:none; border-radius:15px; font-weight:bold; font-size:1.6em;">çµå¸³å®Œæˆ</button>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="card" style="flex:1; font-size: 1em;" id="order-log"></div>
Â  Â  </div>
</div>

<div style="padding:15px; text-align:center; display: flex; justify-content: center; gap: 15px;">
Â  Â  <button onclick="toggleAdmin()" style="padding:15px 25px; border-radius:15px; background:white; border:3px solid var(--main-brown); font-weight:bold; font-size:1.1em; cursor:pointer;">ğŸ› ï¸ å•†å“ç®¡ç† / çµ±è¨ˆ</button>
Â  Â  <button onclick="toggleHistory()" style="padding:15px 25px; border-radius:15px; background:var(--accent-brown); color:white; border:none; font-weight:bold; font-size:1.1em; cursor:pointer;">ğŸ“œ æ­·å²ç´€éŒ„ / é€€è²¨</button>
</div>

<div id="history-panel">
Â  Â  <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
Â  Â  Â  Â  <h2 style="margin:0;">ğŸ“œ æ­·å²ç´€éŒ„ç®¡ç† (é€€è²¨åœ¨æ­¤æ“ä½œ)</h2>
Â  Â  Â  Â  <button onclick="toggleHistory()" style="padding:8px 15px;">âœ• é—œé–‰</button>
Â  Â  </div>
Â  Â  <div style="background:#fdf5f0; padding:15px; border-radius:10px; margin-bottom:15px; display:flex; gap:15px; align-items:center;">
Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  <label>å–®æ—¥æŸ¥è©¢ï¼š</label><input type="date" id="search-date" style="padding:8px;">
Â  Â  Â  Â  Â  Â  <button onclick="searchHistory('day')" style="padding:8px 15px; background:var(--main-brown); color:white; border:none;">ğŸ” æŸ¥è©¢å–®æ—¥</button>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div style="border-left: 2px solid #ddd; padding-left: 15px;">
Â  Â  Â  Â  Â  Â  <label>ç•¶æœˆæŸ¥è©¢ï¼š</label><input type="month" id="search-month" style="padding:8px;">
Â  Â  Â  Â  Â  Â  <button onclick="searchHistory('month')" style="padding:8px 15px; background:var(--accent-brown); color:white; border:none;">ğŸ“Š æŸ¥è©¢ç•¶æœˆ</button>
Â  Â  Â  Â  </div>
Â  Â  </div>
Â  Â  <div id="history-result-area" style="flex:1; overflow-y:auto; background:white; padding:15px; border-radius:10px; border:1px solid #eee;"></div>
</div>

<div id="admin-panel">
Â  Â  <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
Â  Â  Â  Â  <h2 style="margin:0;">âš™ï¸ ç®¡ç†ä¸­å¿ƒ</h2>
Â  Â  Â  Â  <div style="display:flex; gap:10px;">
Â  Â  Â  Â  Â  Â  <select id="admin-cat-jump" onchange="jumpToAdminCat(this.value)" style="padding:8px; border-radius:5px;">
Â  Â  Â  Â  Â  Â  Â  Â  <option value="">å¿«é€Ÿè·³è½‰åˆ†é¡...</option>
Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  <button onclick="exportToExcel()" style="padding:8px 15px; background:#217346; color:white; border:none; cursor:pointer;">ğŸ“¥ åŒ¯å‡º Excel</button>
Â  Â  Â  Â  Â  Â  <button onclick="backupData()" style="padding:8px 15px; background:#666; color:white; border:none; cursor:pointer;">ğŸ’¾ å‚™ä»½æ•¸æ“š</button>
Â  Â  Â  Â  Â  Â  <input type="file" id="import-file" style="display:none;" onchange="importData(event)">
Â  Â  Â  Â  Â  Â  <button onclick="document.getElementById('import-file').click()" style="padding:8px 15px; background:#d9534f; color:white; border:none; cursor:pointer;">âš ï¸ é‚„åŸæ•¸æ“š</button>
Â  Â  Â  Â  Â  Â  <button onclick="toggleAdmin()" style="padding:8px 15px;">âœ• é—œé–‰</button>
Â  Â  Â  Â  </div>
Â  Â  </div>
Â  Â  <div class="add-row-top">
Â  Â  Â  Â  <div><label>åˆ†é¡</label><select id="select-cat" onchange="checkNewCat(this.value)"></select></div>
Â  Â  Â  Â  <div><label>ä»£ç¢¼</label><input type="text" id="new-id" style="width:60px;"></div>
Â  Â  Â  Â  <div><label>å“å</label><input type="text" id="new-n" style="width:180px;"></div>
Â  Â  Â  Â  <div><label>æˆæœ¬</label><input type="number" id="new-c" style="width:60px;"></div>
Â  Â  Â  Â  <div><label>å”®åƒ¹</label><input type="number" id="new-p" style="width:60px;"></div>
Â  Â  Â  Â  <div><label>åº«å­˜</label><input type="number" id="new-s" style="width:60px;"></div>
Â  Â  Â  Â  <button onclick="addNewProduct()" style="background:var(--profit-green); color:white; border:none; padding:10px 20px; border-radius:8px; cursor:pointer;">â• æ–°å¢å•†å“</button>
Â  Â  </div>
Â  Â  <div class="admin-layout">
Â  Â  Â  Â  <div class="admin-table-container">
Â  Â  Â  Â  Â  Â  <table>
Â  Â  Â  Â  Â  Â  Â  Â  <thead><tr><th>é †åº</th><th>å“å</th><th>æˆæœ¬</th><th>å”®åƒ¹</th><th>åº«å­˜</th><th>åˆª</th></tr></thead>
Â  Â  Â  Â  Â  Â  Â  Â  <tbody id="admin-tbody"></tbody>
Â  Â  Â  Â  Â  Â  </table>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div style="background:#f9f9f9; padding:15px; border-radius:10px; overflow-y:auto; display:flex; flex-direction:column; gap:20px;">
Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  <h3>ğŸ“Š ä»Šæ—¥å–®å“éŠ·å”®æ’è¡Œ</h3>
Â  Â  Â  Â  Â  Â  Â  Â  <table style="font-size:0.9em;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <thead><tr style="background:#eee;"><th>å“å</th><th>é‡</th><th>é¡</th></tr></thead>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <tbody id="stat-tbody"></tbody>
Â  Â  Â  Â  Â  Â  Â  Â  </table>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div style="border-top:2px solid #ddd; padding-top:15px;">
Â  Â  Â  Â  Â  Â  Â  Â  <h3>ğŸ“… æœ¬æœˆå–®å“éŠ·å”®çµ±è¨ˆ</h3>
Â  Â  Â  Â  Â  Â  Â  Â  <table style="font-size:0.9em;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <thead><tr style="background:#ddd;"><th>å“å</th><th>ç´¯è¨ˆé‡</th><th>ç´¯è¨ˆé¡</th></tr></thead>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <tbody id="stat-month-tbody"></tbody>
Â  Â  Â  Â  Â  Â  Â  Â  </table>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>
</div>

<script>
Â  Â  const firebaseConfig = {
Â  Â  Â  Â  apiKey: "AIzaSyDn6HtjYMz_FFKU9xjhvV1xXYPr7t36UU0",
Â  Â  Â  Â  authDomain: "little-nook-aad58.firebaseapp.com",
Â  Â  Â  Â  databaseURL: "https://little-nook-aad58-default-rtdb.firebaseio.com/",Â 
Â  Â  Â  Â  projectId: "little-nook-aad58",
Â  Â  Â  Â  storageBucket: "little-nook-aad58.appspot.com",
Â  Â  Â  Â  messagingSenderId: "338959223363",
Â  Â  Â  Â  appId: "1:338959223363:web:71e35d25959c9d57f131a3"
Â  Â  };

Â  Â  firebase.initializeApp(firebaseConfig);
Â  Â  const db = firebase.database();

Â  Â  let inv = [];Â 
Â  Â  let orders = [];
Â  Â  let cart = [];Â 
Â  Â  let currentPay = 'ç¾é‡‘';
Â  Â  let hiddenOrderIds = [];Â 
Â  Â  const ADMIN_PW = "0209"; // é–é »å¯†ç¢¼

Â  Â  // --- ä¿®æ”¹ï¼šé–‹å±é–é »åŠŸèƒ½ ---
Â  Â  window.onload = function() {
Â  Â  Â  Â  let accessGranted = false;
Â  Â  Â  Â  while (!accessGranted) {
Â  Â  Â  Â  Â  Â  const pw = prompt("ğŸ§¸ æ­¡è¿ä¾†åˆ° LITTLE NOOK POS\nè«‹è¼¸å…¥è§£é–å¯†ç¢¼ä»¥é¡¯ç¤ºå…§å®¹ï¼š");
Â  Â  Â  Â  Â  Â  if (pw === ADMIN_PW) {
Â  Â  Â  Â  Â  Â  Â  Â  accessGranted = true;
Â  Â  Â  Â  Â  Â  Â  Â  document.body.style.display = "flex"; // å¯†ç¢¼æ­£ç¢ºï¼Œé¡¯ç¤ºç¶²é 
Â  Â  Â  Â  Â  Â  } else if (pw === null) {
Â  Â  Â  Â  Â  Â  Â  Â  alert("å¿…é ˆè¼¸å…¥å¯†ç¢¼æ‰èƒ½ä½¿ç”¨ç³»çµ±ã€‚");
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  alert("å¯†ç¢¼éŒ¯èª¤ï¼Œè«‹é‡æ–°è¼¸å…¥ï¼");
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  };

Â  Â  db.ref('inventory').on('value', snap => { if(snap.val()) { inv = snap.val(); initUI(); } });
Â  Â  db.ref('orders').on('value', snap => {
Â  Â  Â  Â  const data = snap.val();
Â  Â  Â  Â  orders = data ? Object.keys(data).map(k => ({...data[k], firebaseKey: k})).reverse() : [];
Â  Â  Â  Â  updateLog(); renderStatTable(); renderMonthStatTable();
Â  Â  });

Â  Â  // ä¾ç…§è¦æ±‚ç§»é™¤ checkAccess å¯†ç¢¼é©—è­‰é‚è¼¯

Â  Â  function initUI() {
Â  Â  Â  Â  const area = document.getElementById('item-area'), nav = document.getElementById('navbar');
Â  Â  Â  Â  const jumpSelect = document.getElementById('admin-cat-jump');
Â  Â  Â  Â  area.innerHTML = ''; nav.innerHTML = '';
Â  Â  Â  Â  jumpSelect.innerHTML = '<option value="">å¿«é€Ÿè·³è½‰åˆ†é¡...</option>';
Â  Â  Â  Â Â 
Â  Â  Â  Â  inv.forEach((cat, idx) => {
Â  Â  Â  Â  Â  Â  nav.innerHTML += `<div class="nav-btn" onclick="document.getElementById('c${idx}').scrollIntoView()">${cat.cat}</div>`;
Â  Â  Â  Â  Â  Â  jumpSelect.innerHTML += `<option value="ac${idx}">${cat.cat}</option>`;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  let gridHtml = `<div class="cat-title" id="c${idx}">${cat.cat}</div><div class="product-grid">`;
Â  Â  Â  Â  Â  Â  (cat.items || []).forEach(it => {
Â  Â  Â  Â  Â  Â  Â  Â  if(it.s > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  gridHtml += `<div class="p-btn" onclick="addCart('${it.id}')">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="p-name">${it.id} ${it.n}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="p-price">$${it.p}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="p-stock">å­˜:${it.s}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>`;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  area.innerHTML += gridHtml + '</div>';
Â  Â  Â  Â  });
Â  Â  Â  Â  updateCatSelect();
Â  Â  Â  Â  if(document.getElementById('admin-panel').style.display === 'flex') renderAdminTable();
Â  Â  }

Â  Â  function addCart(id) {
Â  Â  Â  Â  let target = null;
Â  Â  Â  Â  inv.forEach(c => (c.items || []).forEach(i => { if(i.id === id) target = i; }));
Â  Â  Â  Â  if(target && target.s > 0) { cart.push({...target}); renderCart(); }
Â  Â  }

Â  Â  function addExtraCost() {
Â  Â  Â  Â  const amount = prompt("è«‹è¼¸å…¥æ”¯å‡ºé‡‘é¡ï¼š");
Â  Â  Â  Â  if (amount === null || amount === "" || isNaN(amount)) return;
Â  Â  Â  Â  const reason = prompt("è«‹è¼¸å…¥æ”¯å‡ºåŸå›  (ä¾‹å¦‚: è£œå“ã€è²·å†°å¡Šã€è»Šè³‡)ï¼š", "é›œé …æ”¯å‡º");
Â  Â  Â  Â  if (reason === null) return;
Â  Â  Â  Â Â 
Â  Â  Â  Â  const costValue = Number(amount);
Â  Â  Â  Â  const extraItem = {
Â  Â  Â  Â  Â  Â  id: "æ”¯å‡º",
Â  Â  Â  Â  Â  Â  n: `[æ”¯] ${reason}`,
Â  Â  Â  Â  Â  Â  p: 0,
Â  Â  Â  Â  Â  Â  c: costValue,
Â  Â  Â  Â  Â  Â  s: 99999
Â  Â  Â  Â  };
Â  Â  Â  Â  cart.push(extraItem);
Â  Â  Â  Â  renderCart();
Â  Â  Â  Â  const noteInput = document.getElementById('discount-note');
Â  Â  Â  Â  if (!noteInput.value) noteInput.value = `å«æ”¯å‡º: ${reason}($${costValue})`;
Â  Â  }

Â  Â  function renderCart() {
Â  Â  Â  Â  document.getElementById('cart-list').innerHTML = cart.map((it, i) => `
Â  Â  Â  Â  Â  Â  <div class="cart-item"><span>${it.id} ${it.n}</span><b>$${it.p}</b>
Â  Â  Â  Â  Â  Â  <span onclick="cart.splice(${i},1);renderCart()" style="color:red; cursor:pointer;">âœ•</span></div>`).join('');
Â  Â  Â  Â  calc();
Â  Â  }

Â  Â  function calc() {
Â  Â  Â  Â  const total = cart.reduce((a,b)=>a+b.p, 0) - Number(document.getElementById('discount').value || 0);
Â  Â  Â  Â  document.getElementById('final-total').innerText = Math.max(0, total);
Â  Â  Â  Â  calcChange();
Â  Â  }

Â  Â  function calcChange() {
Â  Â  Â  Â  const t = Number(document.getElementById('final-total').innerText), p = Number(document.getElementById('cash-in').value || 0);
Â  Â  Â  Â  document.getElementById('cash-change').innerText = p > t ? p - t : 0;
Â  Â  }

Â  Â  function setPay(m) {
Â  Â  Â  Â  currentPay = m;
Â  Â  Â  Â  document.getElementById('btn-cash').className = m==='ç¾é‡‘'?'pay-btn active':'pay-btn';
Â  Â  Â  Â  document.getElementById('btn-elec').className = m==='é›»æ”¯'?'pay-btn active':'pay-btn';
Â  Â  }

Â  Â  function submitOrder() {
Â  Â  Â  Â  if(!cart.length) return;

Â  Â  Â  Â  let orderDate = new Date().toLocaleDateString('zh-TW');
Â  Â  Â  Â  let orderTime = new Date().toLocaleTimeString();
Â  Â  Â  Â  const isBackdate = document.getElementById('backdate-mode').checked;
Â  Â  Â  Â  const manualDateValue = document.getElementById('manual-date').value;
Â  Â  Â  Â  if (isBackdate && manualDateValue) {
Â  Â  Â  Â  Â  Â  orderDate = new Date(manualDateValue).toLocaleDateString('zh-TW');
Â  Â  Â  Â  Â  Â  orderTime = "23:59:59";
Â  Â  Â  Â  }

Â  Â  Â  Â  const total = Number(document.getElementById('final-total').innerText);
Â  Â  Â  Â  const discount = Number(document.getElementById('discount').value || 0);
Â  Â  Â  Â  const note = document.getElementById('discount-note').value;
Â  Â  Â  Â  const cost = cart.reduce((a,b)=>a+(b.c||0), 0);
Â  Â  Â  Â Â 
Â  Â  Â  Â  const orderData = {
Â  Â  Â  Â  Â  Â  t: orderTime,Â 
Â  Â  Â  Â  Â  Â  d: orderDate,
Â  Â  Â  Â  Â  Â  total,Â 
Â  Â  Â  Â  Â  Â  profit: total - cost,Â 
Â  Â  Â  Â  Â  Â  pay: currentPay,Â 
Â  Â  Â  Â  Â  Â  items: [...cart],
Â  Â  Â  Â  Â  Â  discount,
Â  Â  Â  Â  Â  Â  note
Â  Â  Â  Â  };
Â  Â  Â  Â Â 
Â  Â  Â  Â  cart.forEach(item => { inv.forEach(c => (c.items || []).forEach(i => { if(i.id === item.id) i.s--; })); });

Â  Â  Â  Â  const newOrderRef = db.ref('orders').push();
Â  Â  Â  Â  newOrderRef.set(orderData)
Â  Â  Â  Â  Â  Â  .then(() => db.ref('inventory').set(inv))
Â  Â  Â  Â  Â  Â  .then(() => {
Â  Â  Â  Â  Â  Â  Â  Â  alert(isBackdate ? "è£œç™»æˆåŠŸï¼" : "çµå¸³æˆåŠŸï¼");
Â  Â  Â  Â  Â  Â  Â  Â  cart=[];Â 
Â  Â  Â  Â  Â  Â  Â  Â  ['discount', 'discount-note', 'cash-in', 'manual-date'].forEach(id => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const el = document.getElementById(id);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(el) el.value = '';
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('backdate-mode').checked = false;
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('manual-date').style.display = 'none';
Â  Â  Â  Â  Â  Â  Â  Â  renderCart();
Â  Â  Â  Â  Â  Â  })
Â  Â  Â  Â  Â  Â  .catch(err => {
Â  Â  Â  Â  Â  Â  Â  Â  alert("âš ï¸ ç¶²è·¯ä¸ç©©ï¼Œè³‡æ–™å·²æš«å­˜ï¼Œè«‹ç¨å¾ŒåŒæ­¥ã€‚");
Â  Â  Â  Â  Â  Â  Â  Â  localStorage.setItem('pendingOrder_' + Date.now(), JSON.stringify(orderData));
Â  Â  Â  Â  Â  Â  });
Â  Â  }

Â  Â  function searchHistory(type) {
Â  Â  Â  Â  let filter = "";
Â  Â  Â  Â  if(type === 'day') {
Â  Â  Â  Â  Â  Â  const date = document.getElementById('search-date').value;
Â  Â  Â  Â  Â  Â  if(!date) return alert("è«‹é¸æ“‡æ—¥æœŸ");
Â  Â  Â  Â  Â  Â  filter = new Date(date).toLocaleDateString('zh-TW');
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  const month = document.getElementById('search-month').value;
Â  Â  Â  Â  Â  Â  if(!month) return alert("è«‹é¸æ“‡æœˆä»½");
Â  Â  Â  Â  Â  Â  const parts = month.split('-');
Â  Â  Â  Â  Â  Â  filter = `${parts[0]}/${parseInt(parts[1])}`;Â 
Â  Â  Â  Â  }

Â  Â  Â  Â  const filtered = orders.filter(o => o.d.includes(filter));
Â  Â  Â  Â  const totalSales = filtered.reduce((a,b) => a + b.total, 0);
Â  Â  Â  Â  const totalProfit = filtered.reduce((a,b) => a + (b.profit || 0), 0);

Â  Â  Â  Â  let html = `<div style="padding:10px; background:#eee; border-radius:5px; margin-bottom:10px;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <b>çµ±è¨ˆå°è±¡: ${filter}</b> | ç¸½ç­†æ•¸: ${filtered.length} |Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ç‡Ÿæ”¶: <span style="color:red">$${totalSales}</span> |Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ç¸½ç´¯è¨ˆç²åˆ©: <span style="color:green">$${totalProfit}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>`;

Â  Â  Â  Â  html += filtered.map(o => `
Â  Â  Â  Â  Â  Â  <div class="history-card">
Â  Â  Â  Â  Â  Â  Â  Â  <span class="history-del-btn" onclick="refundOrder('${o.firebaseKey}')">âš ï¸ é€€è²¨å›è£œåº«å­˜</span>
Â  Â  Â  Â  Â  Â  Â  Â  <b>[${o.d} ${o.t}] ç¸½é¡: $${o.total} (${o.pay})</b>Â 
Â  Â  Â  Â  Â  Â  Â  Â  <span style="margin-left:10px; color:var(--profit-green); font-weight:bold;">(å–®ç­†åˆ©æ½¤: $${o.profit || 0})</span>
Â  Â  Â  Â  Â  Â  Â  Â  <div style="font-size:0.9em; color:#666;">å‚™è¨»: ${o.note || 'ç„¡'} | æŠ˜æ‰£: $${o.discount || 0}</div>
Â  Â  Â  Â  Â  Â  Â  Â  <div>${o.items.map(i => `<span class="order-tag">${i.n}</span>`).join('')}</div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  `).join('');
Â  Â  Â  Â Â 
Â  Â  Â  Â  document.getElementById('history-result-area').innerHTML = html || "æŸ¥ç„¡è³‡æ–™";
Â  Â  }

Â  Â  function updateLog() {
Â  Â  Â  Â  const displayList = orders.filter(o => !hiddenOrderIds.includes(o.firebaseKey)).slice(0, 8);
Â  Â  Â  Â  document.getElementById('order-log').innerHTML = `
Â  Â  Â  Â  Â  Â  <div style="display:flex; justify-content:space-between; align-items:center;">
Â  Â  Â  Â  Â  Â  Â  Â  <strong>ğŸ“‹ æœ€è¿‘äº¤æ˜“</strong>
Â  Â  Â  Â  Â  Â  Â  Â  <button class="clear-log-btn" onclick="clearLogDisplay()">ğŸ§¹ æ¸…ç©ºç‰ˆé¢</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <hr>` + displayList.map(o => `
Â  Â  Â  Â  Â  Â  <div style="padding:5px 0; border-bottom:1px solid #eee; position:relative;">
Â  Â  Â  Â  Â  Â  Â  Â  <div style="display:flex; justify-content:space-between;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <b>$${o.total} (${o.t})</b>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span onclick="hideSingleOrder('${o.firebaseKey}')" style="color:#ccc; cursor:pointer; font-weight:bold;">âœ•</span>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div style="font-size:0.8em; color:#888;">${o.note ? 'è¨»:'+o.note : ''}</div>
Â  Â  Â  Â  Â  Â  Â  Â  <div>${o.items.map(i=>`<span class="order-tag">${i.n}</span>`).join('')}</div>
Â  Â  Â  Â  Â  Â  </div>`).join('');
Â  Â  }

Â  Â  function hideSingleOrder(key) { hiddenOrderIds.push(key); updateLog(); }

Â  Â  function clearLogDisplay() {
Â  Â  Â  Â  if(confirm("ç¢ºå®šè¦æ¸…ç©ºç‰ˆé¢é¡¯ç¤ºå—ï¼Ÿ\n(é€™ä¸å½±éŸ¿éŠ·å”®ç´€éŒ„ï¼Œå¯åœ¨æ­·å²ç´€éŒ„ä¸­æŸ¥è©¢)")) {
Â  Â  Â  Â  Â  Â  orders.forEach(o => hiddenOrderIds.push(o.firebaseKey));
Â  Â  Â  Â  Â  Â  updateLog();
Â  Â  Â  Â  }
Â  Â  }

Â  Â  function refundOrder(key) {
Â  Â  Â  Â  if(!confirm("âš ï¸ è­¦å‘Šï¼šé€™å°‡æœƒæ°¸ä¹…åˆªé™¤æ­¤äº¤æ˜“ä¸¦å›è£œåº«å­˜ï¼ç¢ºå®šé€€è²¨ï¼Ÿ")) return;
Â  Â  Â  Â  const order = orders.find(o => o.firebaseKey === key);
Â  Â  Â  Â  if(order && order.items) {
Â  Â  Â  Â  Â  Â  order.items.forEach(ri => inv.forEach(c => (c.items||[]).forEach(i => { if(i.id===ri.id) i.s++; })));
Â  Â  Â  Â  Â  Â  db.ref('orders/' + key).remove().then(() => db.ref('inventory').set(inv));
Â  Â  Â  Â  }
Â  Â  }

Â  Â  function syncOfflineData() {
Â  Â  Â  Â  let syncedCount = 0;
Â  Â  Â  Â  for (let i = 0; i < localStorage.length; i++) {
Â  Â  Â  Â  Â  Â  const key = localStorage.key(i);
Â  Â  Â  Â  Â  Â  if (key.startsWith('pendingOrder_')) {
Â  Â  Â  Â  Â  Â  Â  Â  const data = JSON.parse(localStorage.getItem(key));
Â  Â  Â  Â  Â  Â  Â  Â  db.ref('orders').push(data);
Â  Â  Â  Â  Â  Â  Â  Â  localStorage.removeItem(key);
Â  Â  Â  Â  Â  Â  Â  Â  syncedCount++;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â  alert(syncedCount > 0 ? `âœ… å·²æˆåŠŸåŒæ­¥ ${syncedCount} ç­†é›¢ç·šè¨‚å–®ï¼` : "ç›®å‰æ²’æœ‰éœ€è¦åŒæ­¥çš„æ•¸æ“šã€‚");
Â  Â  }

Â  Â  function renderStatTable() {
Â  Â  Â  Â  const today = new Date().toLocaleDateString('zh-TW');
Â  Â  Â  Â  const tOrders = orders.filter(o => o.d === today);
Â  Â  Â  Â  const sum = {};
Â  Â  Â  Â  tOrders.forEach(o => (o.items||[]).forEach(i => {Â 
Â  Â  Â  Â  Â  Â  if(!sum[i.n]) sum[i.n]={c:0,t:0}; sum[i.n].c++; sum[i.n].t += i.p;Â 
Â  Â  Â  Â  }));
Â  Â  Â  Â  let html = Object.keys(sum).sort((a,b)=>sum[b].c - sum[a].c).map(n =>Â 
Â  Â  Â  Â  Â  Â  `<tr><td style="text-align:left;">${n}</td><td>${sum[n].c}</td><td>$${sum[n].t}</td></tr>`
Â  Â  Â  Â  ).join('');
Â  Â  Â  Â  document.getElementById('stat-tbody').innerHTML = html || '<tr><td colspan="3">ä»Šæ—¥å°šç„¡éŠ·å”®</td></tr>';
Â  Â  }

Â  Â  function renderMonthStatTable() {
Â  Â  Â  Â  const now = new Date();
Â  Â  Â  Â  const thisMonth = now.getFullYear() + "/" + (now.getMonth() + 1);
Â  Â  Â  Â  const mOrders = orders.filter(o => o.d.startsWith(thisMonth));
Â  Â  Â  Â  const sum = {};
Â  Â  Â  Â  mOrders.forEach(o => (o.items||[]).forEach(i => {Â 
Â  Â  Â  Â  Â  Â  if(!sum[i.n]) sum[i.n]={c:0,t:0}; sum[i.n].c++; sum[i.n].t += i.p;Â 
Â  Â  Â  Â  }));
Â  Â  Â  Â  let html = Object.keys(sum).sort((a,b)=>sum[b].c - sum[a].c).map(n =>Â 
Â  Â  Â  Â  Â  Â  `<tr><td style="text-align:left;">${n}</td><td>${sum[n].c}</td><td>$${sum[n].t}</td></tr>`
Â  Â  Â  Â  ).join('');
Â  Â  Â  Â  document.getElementById('stat-month-tbody').innerHTML = html || '<tr><td colspan="3">æœ¬æœˆå°šç„¡æ•¸æ“š</td></tr>';
Â  Â  }

Â  Â  function addNewProduct() {
Â  Â  Â  Â  const catN = document.getElementById('select-cat').value;
Â  Â  Â  Â  const id = document.getElementById('new-id').value, n = document.getElementById('new-n').value;
Â  Â  Â  Â  const c = Number(document.getElementById('new-c').value), p = Number(document.getElementById('new-p').value), s = Number(document.getElementById('new-s').value);
Â  Â  Â  Â  if(!n || !catN) return alert("è«‹å¡«å¯«å“åèˆ‡åˆ†é¡");
Â  Â  Â  Â  const category = inv.find(v => v.cat === catN);
Â  Â  Â  Â  if(category) {
Â  Â  Â  Â  Â  Â  if(!category.items) category.items = [];
Â  Â  Â  Â  Â  Â  category.items.push({id, n, c, p, s});
Â  Â  Â  Â  Â  Â  db.ref('inventory').set(inv).then(() => {
Â  Â  Â  Â  Â  Â  Â  Â  alert("å·²æ–°å¢");
Â  Â  Â  Â  Â  Â  Â  Â  ['new-id','new-n','new-c','new-p','new-s'].forEach(f => document.getElementById(f).value='');
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }
Â  Â  }

Â  Â  function checkNewCat(val) {
Â  Â  Â  Â  if(val==="ADD") {Â 
Â  Â  Â  Â  Â  Â  const n = prompt("æ–°åˆ†é¡åç¨±ï¼š");Â 
Â  Â  Â  Â  Â  Â  if(n){ inv.push({cat:n, items:[]}); db.ref('inventory').set(inv).then(() => updateCatSelect()); }
Â  Â  Â  Â  Â  Â  else { document.getElementById('select-cat').selectedIndex = 0; }
Â  Â  Â  Â  }
Â  Â  }

Â  Â  function renameCat(ci) {
Â  Â  Â  Â  const oldN = inv[ci].cat;
Â  Â  Â  Â  const newN = prompt("è«‹è¼¸å…¥åˆ†é¡ [" + oldN + "] çš„æ–°åç¨±ï¼š", oldN);
Â  Â  Â  Â  if (newN && newN !== oldN) {
Â  Â  Â  Â  Â  Â  inv[ci].cat = newN;
Â  Â  Â  Â  Â  Â  db.ref('inventory').set(inv).then(() => alert("åˆ†é¡åç¨±å·²ä¿®æ”¹"));
Â  Â  Â  Â  }
Â  Â  }

Â  Â  function deleteCat(ci) {
Â  Â  Â  Â  if (confirm("ç¢ºå®šè¦åˆªé™¤æ•´å€‹åˆ†é¡ [" + inv[ci].cat + "] å—ï¼Ÿ\n(åˆ†é¡å…§çš„å•†å“ä¹Ÿæœƒä¸€èµ·åˆªé™¤ï¼)")) {
Â  Â  Â  Â  Â  Â  inv.splice(ci, 1);
Â  Â  Â  Â  Â  Â  db.ref('inventory').set(inv).then(() => alert("åˆ†é¡å·²åˆªé™¤"));
Â  Â  Â  Â  }
Â  Â  }

Â  Â  function updateCatSelect() {
Â  Â  Â  Â  const sel = document.getElementById('select-cat');
Â  Â  Â  Â  if(sel) sel.innerHTML = inv.map(c => `<option value="${c.cat}">${c.cat}</option>`).join('') + `<option value="ADD">â• æ–°å¢åˆ†é¡</option>`;
Â  Â  }

Â  Â  function jumpToAdminCat(val) { if(val) document.getElementById(val).scrollIntoView({behavior: "smooth"}); }

Â  Â  function renderAdminTable() {
Â  Â  Â  Â  let html = '';
Â  Â  Â  Â  inv.forEach((cat, ci) => {
Â  Â  Â  Â  Â  Â  html += `<tr id="ac${ci}" style="background:#eee;">
Â  Â  Â  Â  Â  Â  Â  Â  <td colspan="6" style="text-align:left; padding:10px;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <b>ğŸ“‚ ${cat.cat}</b>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="cat-action-btn" onclick="renameCat(${ci})">âœï¸ æ”¹å</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="cat-action-btn" onclick="deleteCat(${ci})" style="color:red;">ğŸ—‘ï¸ åˆªé™¤åˆ†é¡</button>
Â  Â  Â  Â  Â  Â  Â  Â  </td>
Â  Â  Â  Â  Â  Â  </tr>`;
Â  Â  Â  Â  Â  Â  (cat.items || []).forEach((it, ii) => {
Â  Â  Â  Â  Â  Â  Â  Â  html += `<tr>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td><span onclick="move(${ci},${ii},-1)" style="cursor:pointer">â†‘</span> <span onclick="move(${ci},${ii},1)" style="cursor:pointer">â†“</span></td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td style="text-align:left;"><input type="text" value="${it.n}" onchange="editItem(${ci},${ii},'n',this.value)" class="admin-input-large"></td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td><input type="number" value="${it.c}" onchange="editItem(${ci},${ii},'c',this.value)" style="width:50px;"></td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td><input type="number" value="${it.p}" onchange="editItem(${ci},${ii},'p',this.value)" style="width:50px;"></td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td><input type="number" value="${it.s}" onchange="editItem(${ci},${ii},'s',this.value)" style="width:50px;"></td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td><span onclick="delP(${ci},${ii})" class="del-x">âœ•</span></td>
Â  Â  Â  Â  Â  Â  Â  Â  </tr>`;
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  });
Â  Â  Â  Â  document.getElementById('admin-tbody').innerHTML = html;
Â  Â  }

Â  Â  function editItem(ci, ii, k, v) { inv[ci].items[ii][k] = (k==='n'?v:Number(v)); db.ref('inventory').set(inv); }
Â  Â  function move(ci, ii, dir) {Â 
Â  Â  Â  Â  let items = inv[ci].items;Â 
Â  Â  Â  Â  if(ii+dir>=0 && ii+dir<items.length){ [items[ii], items[ii+dir]]=[items[ii+dir], items[ii]]; db.ref('inventory').set(inv); }
Â  Â  }
Â  Â  function delP(ci, ii) { if(confirm("ç¢ºå®šåˆªé™¤ï¼Ÿ")){ inv[ci].items.splice(ii,1); db.ref('inventory').set(inv); } }

Â  Â  function backupData() {
Â  Â  Â  Â  const fullData = { inventory: inv, orders: orders };
Â  Â  Â  Â  const blob = new Blob([JSON.stringify(fullData, null, 2)], { type: "application/json" });
Â  Â  Â  Â  const a = document.createElement("a");
Â  Â  Â  Â  a.href = URL.createObjectURL(blob);
Â  Â  Â  Â  a.download = `LittleNook_Backup_${new Date().toLocaleDateString()}.json`;
Â  Â  Â  Â  a.click();
Â  Â  }

Â  Â  function importData(event) {
Â  Â  Â  Â  const file = event.target.files[0];
Â  Â  Â  Â  if (!file || !confirm("ç¢ºå®šé‚„åŸï¼Ÿé€™æœƒè¦†è“‹ç›®å‰æ‰€æœ‰æ•¸æ“šï¼")) return;
Â  Â  Â  Â  const reader = new FileReader();
Â  Â  Â  Â  reader.onload = e => {
Â  Â  Â  Â  Â  Â  const data = JSON.parse(e.target.result);
Â  Â  Â  Â  Â  Â  if (data.inventory) db.ref('/').set(data).then(() => location.reload());
Â  Â  Â  Â  };
Â  Â  Â  Â  reader.readAsText(file);
Â  Â  }

Â  Â  function exportToExcel() {
Â  Â  Â  Â  const data = orders.map(o => ({Â 
Â  Â  Â  Â  Â  Â  "æ—¥æœŸ": o.d, "æ™‚é–“": o.t, "ä»˜æ¬¾æ–¹å¼": o.pay,Â 
Â  Â  Â  Â  Â  Â  "æŠ˜æ‰£": o.discount || 0, "å‚™è¨»": o.note || "",
Â  Â  Â  Â  Â  Â  "ç¸½é‡‘é¡": o.total, "ä¼°è¨ˆæ¯›åˆ©": o.profit || 0,
Â  Â  Â  Â  Â  Â  "å•†å“æ¸…å–®": o.items.map(i=>i.n).join(',')Â 
Â  Â  Â  Â  }));
Â  Â  Â  Â  const ws = XLSX.utils.json_to_sheet(data);
Â  Â  Â  Â  const wb = XLSX.utils.book_new();
Â  Â  Â  Â  XLSX.utils.book_append_sheet(wb, ws, "éŠ·å”®å…¨ç´€éŒ„");
Â  Â  Â  Â  XLSX.writeFile(wb, `LittleNook_Sales_${new Date().toLocaleDateString()}.xlsx`);
Â  Â  }

Â  Â  function toggleAdmin() { const p = document.getElementById('admin-panel'); p.style.display = p.style.display === 'flex' ? 'none' : 'flex'; if(p.style.display === 'flex') renderAdminTable(); }
Â  Â  function toggleHistory() { const p = document.getElementById('history-panel'); p.style.display = p.style.display === 'flex' ? 'none' : 'flex'; }
</script>
</body>
</html>

å‹¿åˆªæ¸›å‹¿äº‚æ”¹
